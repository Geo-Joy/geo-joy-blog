<!DOCTYPE html>
<html lang="en-us" class="wf-loading">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="preload" href="http://geojoy.me/js/main.js" as="script" />
        <link rel="preload" href="http://geojoy.me/css/main.css" as="style" />

        <title>Génération de code avec Maven et Freemarker</title>
        <meta name="generator" content="Hugo 0.32.4" />
        
        <link rel="preconnect" href="https://ajax.googleapis.com/" crossorigin>
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
        <meta property="og:title" content="Génération de code avec Maven et Freemarker" />
<meta property="og:description" content="Utilisation du plugin fmpp pour maven pour générer du code lors du processus de génération." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://geojoy.me/post---copy/generation-de-code-avec-maven-et-freemarker/" />



<meta property="article:published_time" content="2013-01-24T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-03-01T11:27:28&#43;01:00"/>











    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2013-01-24T00:00:00Z" />
        <meta property="og:article:tag" content="maven" />
        <meta property="og:article:tag" content="freemarker" />
        <meta property="og:article:tag" content="java" />
        
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@megeojoy" />
        <meta name="twitter:creator" content="@megeojoy" />
        <meta name="twitter:title" content="Génération de code avec Maven et Freemarker" />
        <meta name="twitter:description" content="Utilisation du plugin fmpp pour maven pour générer du code lors du processus de génération." />
        <meta name="twitter:url" content="http://geojoy.me/post---copy/generation-de-code-avec-maven-et-freemarker/" />
        
    

    
        <meta name="p:domain_verify" content="58lHJFznHgioHOIv2NvLfobc8XEUUZSKm016uFFO4vE"/>
    

    
    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Geo Joy",
      "url": "http://geojoy.me",
      "sameAs": [
        "https://twitter.com/megeojoy",
        "https://www.linkedin.com/in/geojoy/",
        "https://github.com/Geo-Joy",
      ],
      "image": {
        "@type": "ImageObject",
        "url": "https://geojoy.me/images/avatar.jpg",
        "height": 80,
        "width": 80
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "@id": "http://geojoy.me",
      "name": "Geo&#39;z Blog",
      "url": "http://geojoy.me",
      "logo": {
        "@type": "ImageObject",
        "url": "https://geojoy.me/images/avatar.jpg",
        "height": 80,
        "width": 80
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "url": "http://geojoy.me",
      "name": "Geo&#39;z Blog",
      "author": {
        "@type": "Person",
        "name": "Geo Joy"
      },
      "description": ""
    }
    </script>

      
      <script type="application/ld+json">
      {
          "@context": "http://schema.org",
          "@type": "BlogPosting",
          "headline": "Génération de code avec Maven et Freemarker",
          "description": "Utilisation du plugin fmpp pour maven pour générer du code lors du processus de génération.",
          "author": {
              "@type": "Person",
              "name": "Geo Joy"
          },
          "publisher": {
              "@type": "Organization",
              "name": "Geo&#39;z Blog",
              "logo": "https://geojoy.me/images/avatar.jpg"
          },
          
          "image": {
            "@type": "ImageObject",
            "url": "https://geojoy.me/images/avatar.jpg",
            "height": 80,
            "width": 80
          },
          "datePublished": "2013-01-24",
          "dateModified": "2017-03-01",
          "wordCount": 997
          ,
          "keywords": ["maven","freemarker","java"] 
      }
    </script>
  

    <style>
    body {
        margin: 0
    }

    main,
    nav {
        display: block
    }

    a {
        background-color: transparent
    }

    h1 {
        margin: .67em 0;
        font-size: 2em
    }

    img {
        border: 0
    }

    code,
    kbd {
        font-family: monospace, monospace;
        font-size: 1em
    }

    button {
        margin: 0;
        font: inherit;
        color: inherit
    }

    button {
        overflow: visible
    }

    button {
        text-transform: none
    }

    button {
        -webkit-appearance: button
    }

    button::-moz-focus-inner {
        padding: 0;
        border: 0
    }

    * {
        -webkit-box-sizing: border-box;
        box-sizing: border-box
    }

    :after,
    :before {
        -webkit-box-sizing: border-box;
        box-sizing: border-box
    }

    html {
        font-size: 10px
    }

    body {
        font-family: "Raleway", Helvetica, Arial, sans-serif;
        font-size: 14px;
        line-height: 1.42857143;
        color: #333;
        background-color: #000
    }

    button {
        font-family: inherit;
        font-size: inherit;
        line-height: inherit
    }

    a {
        color: #337ab7;
        text-decoration: none
    }

    img {
        vertical-align: middle
    }

    h1,
    h4,
    h5 {
        font-family: inherit;
        font-weight: 500;
        line-height: 1.1;
        color: inherit
    }

    h1 {
        margin-top: 20px;
        margin-bottom: 10px
    }

    h4,
    h5 {
        margin-top: 10px;
        margin-bottom: 10px
    }

    h1 {
        font-size: 36px
    }

    h4 {
        font-size: 18px
    }

    h5 {
        font-size: 14px
    }

    p {
        margin: 0 0 10px
    }

    .text-justify {
        text-align: justify
    }

    ul {
        margin-top: 0;
        margin-bottom: 10px
    }

    blockquote {
        padding: 10px 20px;
        margin: 0 0 20px;
        font-size: 17.5px;
        border-left: 5px solid #000
    }

    blockquote p:last-child {
        margin-bottom: 0
    }

    code,
    kbd {
        font-family: Menlo, Monaco, Consolas, "Courier New", monospace
    }

    code {
        padding: 2px 4px;
        font-size: 90%;
        color: #c7254e;
        background-color: #000;
        border-radius: 4px
    }

    kbd {
        padding: 2px 4px;
        font-size: 90%;
        color: #000;
        background-color: #333;
        border-radius: 3px;
        -webkit-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .25);
        box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .25)
    }

    .container {
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto;
        margin-left: auto
    }

    @media (min-width:768px) {
        .container {
            width: 750px
        }
    }

    @media (min-width:992px) {
        .container {
            width: 970px
        }
    }

    @media (min-width:1200px) {
        .container {
            width: 1170px
        }
    }

    .collapse {
        display: none
    }

    .nav {
        padding-left: 0;
        margin-bottom: 0;
        list-style: none
    }

    .nav>li {
        position: relative;
        display: block
    }

    .nav>li>a {
        position: relative;
        display: block;
        padding: 10px 15px
    }

    .navbar {
        position: relative;
        min-height: 50px;
        margin-bottom: 20px;
        border: 1px solid transparent
    }

    @media (min-width:768px) {
        .navbar {
            border-radius: 4px
        }
    }

    @media (min-width:768px) {
        .navbar-header {
            float: left
        }
    }

    .navbar-collapse {
        padding-right: 15px;
        padding-left: 15px;
        overflow-x: visible;
        -webkit-overflow-scrolling: touch;
        border-top: 1px solid transparent;
        -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, .1);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, .1)
    }

    @media (min-width:768px) {
        .navbar-collapse {
            width: auto;
            border-top: 0;
            -webkit-box-shadow: none;
            box-shadow: none
        }
        .navbar-collapse.collapse {
            display: block !important;
            height: auto !important;
            padding-bottom: 0;
            overflow: visible !important
        }
        .navbar-fixed-top .navbar-collapse {
            padding-right: 0;
            padding-left: 0
        }
    }

    .navbar-fixed-top .navbar-collapse {
        max-height: 340px
    }

    @media (max-device-width:480px) and (orientation:landscape) {
        .navbar-fixed-top .navbar-collapse {
            max-height: 200px
        }
    }

    .container>.navbar-collapse,
    .container>.navbar-header {
        margin-right: -15px;
        margin-left: -15px
    }

    @media (min-width:768px) {
        .container>.navbar-collapse,
        .container>.navbar-header {
            margin-right: 0;
            margin-left: 0
        }
    }

    .navbar-fixed-top {
        position: fixed;
        right: 0;
        left: 0;
        z-index: 1030
    }

    @media (min-width:768px) {
        .navbar-fixed-top {
            border-radius: 0
        }
    }

    .navbar-fixed-top {
        top: 0;
        border-width: 0 0 1px
    }

    .navbar-brand {
        float: left;
        height: 50px;
        padding: 15px 15px;
        font-size: 18px;
        line-height: 20px
    }

    @media (min-width:768px) {
        .navbar>.container .navbar-brand {
            margin-left: -15px
        }
    }

    .navbar-toggle {
        position: relative;
        float: right;
        padding: 9px 10px;
        margin-top: 8px;
        margin-right: 15px;
        margin-bottom: 8px;
        background-color: transparent;
        background-image: none;
        border: 1px solid transparent;
        border-radius: 4px
    }

    .navbar-toggle .icon-bar {
        display: block;
        width: 22px;
        height: 2px;
        border-radius: 1px
    }

    .navbar-toggle .icon-bar+.icon-bar {
        margin-top: 4px
    }

    @media (min-width:768px) {
        .navbar-toggle {
            display: none
        }
    }

    .navbar-nav {
        margin: 7.5px -15px
    }

    .navbar-nav>li>a {
        padding-top: 10px;
        padding-bottom: 10px;
        line-height: 20px
    }

    @media (min-width:768px) {
        .navbar-nav {
            float: left;
            margin: 0
        }
        .navbar-nav>li {
            float: left
        }
        .navbar-nav>li>a {
            padding-top: 15px;
            padding-bottom: 15px
        }
    }

    @media (min-width:768px) {
        .navbar-right {
            float: right !important;
            margin-right: -15px
        }
    }

    .navbar-default {
        background-color: #000;
        border-color: #313131
    }

    .navbar-default .navbar-brand {
        color: #777
    }

    .navbar-default .navbar-nav>li>a {
        color: #ffffffd6
    }

    .navbar-default .navbar-toggle {
        border-color: #ddd
    }

    .navbar-default .navbar-toggle .icon-bar {
        background-color: #888
    }

    .navbar-default .navbar-collapse {
        border-color: #e7e7e7
    }

    .container:after,
    .container:before,
    .nav:after,
    .nav:before,
    .navbar-collapse:after,
    .navbar-collapse:before,
    .navbar-header:after,
    .navbar-header:before,
    .navbar:after,
    .navbar:before {
        display: table;
        content: " "
    }

    .container:after,
    .nav:after,
    .navbar-collapse:after,
    .navbar-header:after,
    .navbar:after {
        clear: both
    }

    @-ms-viewport {
        width: device-width
    }

    .visible-xs {
        display: none !important
    }

    @media (max-width:767px) {
        .visible-xs {
            display: block !important
        }
    }

    html {
        height: 100%
    }

    body {
        height: 100%;
        padding-top: 55px;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        text-align: center;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        font-size: 16px !important
    }

    main {
        margin: auto;
        padding: 25px;
        max-width: 750px
    }

    a:link,
    a:visited {
        color: green
    }

    .item {
        padding: 10px 0
    }

    .item-tag {
        background-color: green
    }

    .navbar-icon {
        font-size: 125%;
        display: inline-block !important
    }

    .navbar.navbar-default {
        border-top: 4px solid #08ea08
    }

    img {
        max-width: 100%
    }

    .fade-in {
        opacity: 0
    }

    .wf-loading p,
    .wf-loading h1,
    .wf-loading h2,
    .wf-loading h3,
    .wf-loading h4,
    .wf-loading a {
        visibility: hidden;
    }

    .wf-active p,
    .wf-active h1,
    .wf-active h2,
    .wf-active h3,
    .wf-active h4,
    .wf-active a {
        visibility: visible;
    }

    .wf-inactive p,
    .wf-inactive h1,
    .wf-inactive h2,
    .wf-inactive h3,
    .wf-inactive h4,
    wf-inactive a {
        visibility: visible;
    }
</style>
    </head>

    <body bgcolor="#000">
      
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQ3JDPK"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      

        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Génération de code avec Maven et Freemarker</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/project/">Projects</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="/resume/"><i class="fa fa-user"></i></a></li>
                            
                                <li class="navbar-icon"><a href="http://www.google.com/recaptcha/mailhide/d?k=01IIc-s5LNYiS-CG_gthn4PA==&amp;c=r5Ctx8RMDz422qmYESfk1g=="><i class="fa fa-envelope"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/Geo-Joy"><i class="fa fa-github-alt"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/megeojoy"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/geojoy/"><i class="fa fa-linkedin"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main class="fade-in">

    <div class="item">

    
    
    

    
      

    <h4><a itemprop="url" href="/post---copy/generation-de-code-avec-maven-et-freemarker/">
      <span itemprop="name">Génération de code avec Maven et Freemarker</span>
    </a></h4>

    January 24, 2013
    <h5>Utilisation du plugin fmpp pour maven pour générer du code lors du processus de génération.</h5>
     <a href="../../../../../tags/maven"><kbd class="item-tag">maven</kbd></a>  <a href="../../../../../tags/freemarker"><kbd class="item-tag">freemarker</kbd></a>  <a href="../../../../../tags/java"><kbd class="item-tag">java</kbd></a> 

</div>


    <br> <div class="text-justify">

<p>J&rsquo;utilise de plus en plus dans mes applications les évènements Spring car je trouve ça tout simplement pratique et cela offre un découplage simple et efficace des applications.</p>

<p>Ces évènements sont à la fois des évènements de type Entity : Create, Delete, Update, mais aussi ils peuvent être Business. Ils sont représentés sous la forme de classes souvent en quantité.</p>

<p>Je n&rsquo;ai pas souvent l&rsquo;occasion d&rsquo;utiliser mes connaissances en métamodélisation, et ou génération de code, en entreprise, mais quand l&rsquo;occasion se présente j&rsquo;en profite.</p>

<p>Il arrive souvent que l&rsquo;on nécessite un peu de génération de code lors de la construction d&rsquo;artefact; Attention je parle pas de MDA, mais bien de génération ponctuelle.</p>

<p>C&rsquo;est ce qui a motivé cet article.</p>

<h1 id="freemarker">FreeMarker</h1>

<p><a href="http://freemarker.sourceforge.net/">FreeMarker</a> est un moteur de template Java, tout comme <a href="http://velocity.apache.org/">Velocity</a>, ou <a href="http://www.stringtemplate.org/">StringTemplate</a>.</p>

<p>Il est capable de générer des fichiers de sortie type texte, à partir des modèles et de données. Il est souvent utilisé comme moteur dans <a href="http://freemarker.sourceforge.net/poweredBy.html">les applications Java</a> car il est entièrement écrit dans ce même langage.</p>

<p>Voici un exemple de fichier FreeMarker (sample.ftl)</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ef6155">&lt;</span>#assign book = doc.book&gt;
&lt;<span style="color:#5bc4bf">h1</span>&gt;${book.title}&lt;/<span style="color:#5bc4bf">h1</span>&gt;
<span style="color:#ef6155">&lt;</span>#list book.chapter as ch&gt;
  &lt;<span style="color:#5bc4bf">h2</span>&gt;${ch.title}&lt;/<span style="color:#5bc4bf">h2</span>&gt;
  <span style="color:#ef6155">&lt;</span>#list ch.para as p&gt;
    &lt;<span style="color:#5bc4bf">p</span>&gt;${p}&lt;/<span style="color:#5bc4bf">p</span>&gt;
  <span style="color:#ef6155">&lt;</span>/#list&gt;
<span style="color:#ef6155">&lt;</span>/#list&gt;</code></pre></div>
<p>Les instructions <code>${}</code> sont des placeholders qui seront remplacés à la fusion entre les données et le template.
Les instructions <code>&lt;# &gt;</code>sont les instructions FreeMarker, elles peuvent être de commandes de contrôle de flot (if, then, etc.), mais aussi des instructions de boucles (list, etc.)</p>

<p>L&rsquo;instruction <code>#list</code> est un équivalent d&rsquo;un <code>foreach</code>.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#5bc4bf">&lt;book&gt;</span>
  <span style="color:#5bc4bf">&lt;title&gt;</span>Test Book<span style="color:#5bc4bf">&lt;/title&gt;</span>
  <span style="color:#5bc4bf">&lt;chapter&gt;</span>
    <span style="color:#5bc4bf">&lt;title&gt;</span>Ch1<span style="color:#5bc4bf">&lt;/title&gt;</span>
    <span style="color:#5bc4bf">&lt;para&gt;</span>p1.1<span style="color:#5bc4bf">&lt;/para&gt;</span>
    <span style="color:#5bc4bf">&lt;para&gt;</span>p1.2<span style="color:#5bc4bf">&lt;/para&gt;</span>
    <span style="color:#5bc4bf">&lt;para&gt;</span>p1.3<span style="color:#5bc4bf">&lt;/para&gt;</span>
  <span style="color:#5bc4bf">&lt;/chapter&gt;</span>
  <span style="color:#5bc4bf">&lt;chapter&gt;</span>
    <span style="color:#5bc4bf">&lt;title&gt;</span>Ch2<span style="color:#5bc4bf">&lt;/title&gt;</span>
    <span style="color:#5bc4bf">&lt;para&gt;</span>p2.1<span style="color:#5bc4bf">&lt;/para&gt;</span>
    <span style="color:#5bc4bf">&lt;para&gt;</span>p2.2<span style="color:#5bc4bf">&lt;/para&gt;</span>
  <span style="color:#5bc4bf">&lt;/chapter&gt;</span>
<span style="color:#5bc4bf">&lt;/book&gt;</span></code></pre></div>
<p>En joignant le fichier XML précédent avec le template, on obtient :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#5bc4bf">h1</span>&gt;Test&lt;/<span style="color:#5bc4bf">h1</span>&gt;
  &lt;<span style="color:#5bc4bf">h2</span>&gt;Ch1&lt;/<span style="color:#5bc4bf">h2</span>&gt;
    &lt;<span style="color:#5bc4bf">p</span>&gt;p1.1
    &lt;<span style="color:#5bc4bf">p</span>&gt;p1.2
    &lt;<span style="color:#5bc4bf">p</span>&gt;p1.3
  &lt;<span style="color:#5bc4bf">h2</span>&gt;Ch2&lt;/<span style="color:#5bc4bf">h2</span>&gt;
    &lt;<span style="color:#5bc4bf">p</span>&gt;p2.1
    &lt;<span style="color:#5bc4bf">p</span>&gt;p2.2</code></pre></div>
<p>Notez que l&rsquo;indentation est sauvegardée, cela pourra vous poser des problèmes dans certains cas.</p>

<p>Pour plus d&rsquo;informations, je vous invite à consulter la documentation
&ldquo;<a href="http://freemarker.sourceforge.net/docs/xgui_imperative_learn.html">Learning by example</a>&rdquo;.</p>

<h2 id="fmpp-freemarker-based-text-file-preprocessor">FMPP : FreeMarker-based text file PreProcessor</h2>

<p><a href="http://fmpp.sourceforge.net/">FMPP</a> est un outil dérivé de FreeMarker, il se présente sous plusieurs formes :
  * Un outil en ligne de commande
  * Extension ANT</p>

<p>Il permet d&rsquo;effectuer des fusion de modèles à partir d&rsquo;un script SHELL ou ANT. C&rsquo;est un outil très pratique car notament il peut utiliser tout un tas de type de <a href="http://fmpp.sourceforge.net/dataloader.html">source en entrée</a> (CSV, Java Properties, Txt, XML, HTML, etc.).</p>

<h1 id="maven">Maven</h1>

<p><a href="http://maven.apache.org/">Maven</a> est un outil de gestion d&rsquo;environnement de construction spécialisé pour Java.</p>

<p>Cet outil apporte un certains cadre lié au cycle de génération d&rsquo;une application (compilation, test, packaging, etc.), mais aussi une extensibilité que je qualifirais d&rsquo;exemplaire.</p>

<p><a href="http://fr.wikipedia.org/wiki/Apache_Maven">Plus d&rsquo;informations ?</a></p>

<h2 id="plugin-ffmp-pour-maven">Plugin FFMP pour Maven</h2>

<p>Ce <a href="http://code.google.com/p/freemarkerpp-maven-plugin/">plugin</a> permet d&rsquo;utiliser FMPP au sein d&rsquo;un processus de génération Maven.</p>

<p>Pour pouvoir utiliser le plugin dans votre projet, il suffit de déclarer un  plugin dans votre fichier <code>pom.xml</code></p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#5bc4bf">&lt;plugin&gt;</span>
  <span style="color:#5bc4bf">&lt;groupId&gt;</span>com.googlecode.fmpp-maven-plugin<span style="color:#5bc4bf">&lt;/groupId&gt;</span>
  <span style="color:#5bc4bf">&lt;artifactId&gt;</span>fmpp-maven-plugin<span style="color:#5bc4bf">&lt;/artifactId&gt;</span>
  <span style="color:#5bc4bf">&lt;version&gt;</span>1.0<span style="color:#5bc4bf">&lt;/version&gt;</span>
<span style="color:#5bc4bf">&lt;plugin&gt;</span></code></pre></div>
<p>Il faut ordonner la génération du code lors de la compilation de l&rsquo;artefact pour cela vous devez configuration la phase d&rsquo;invocation du plugin :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#5bc4bf">&lt;configuration&gt;</span>
  <span style="color:#776e71">&lt;!-- Fichier de configuration FMPP --&gt;</span>
  <span style="color:#5bc4bf">&lt;cfgFile&gt;</span>src/main/fmpp/config.fmpp<span style="color:#5bc4bf">&lt;/cfgFile&gt;</span>
  <span style="color:#776e71">&lt;!-- Configuration du repertoire par défaut de sortie --&gt;</span>
  <span style="color:#5bc4bf">&lt;outputDirectory&gt;</span>target/generated-sources/main/java<span style="color:#5bc4bf">&lt;/outputDirectory&gt;</span>
  <span style="color:#776e71">&lt;!-- Repertoire contenant les templates *.ftl --&gt;</span>
  <span style="color:#5bc4bf">&lt;templateDirectory&gt;</span>src/main/fmpp/templates<span style="color:#5bc4bf">&lt;/templateDirectory&gt;</span>
<span style="color:#5bc4bf">&lt;/configuration&gt;</span>
<span style="color:#776e71">&lt;!-- Cela va invoquer le plugin lors du traitement de la phase &#34;generate&#34; --&gt;</span>
<span style="color:#5bc4bf">&lt;executions&gt;</span>
  <span style="color:#5bc4bf">&lt;execution&gt;</span>
    <span style="color:#5bc4bf">&lt;phase&gt;</span>generate-sources<span style="color:#5bc4bf">&lt;/phase&gt;</span>
    <span style="color:#5bc4bf">&lt;goals&gt;</span>
      <span style="color:#5bc4bf">&lt;goal&gt;</span>generate<span style="color:#5bc4bf">&lt;/goal&gt;</span>
    <span style="color:#5bc4bf">&lt;/goals&gt;</span>
  <span style="color:#5bc4bf">&lt;/execution&gt;</span>
<span style="color:#5bc4bf">&lt;/executions&gt;</span></code></pre></div>
<p>Voila qui en est terminé de la configuration Maven !</p>

<h1 id="génération-du-code">Génération du code</h1>

<p>Nous allons procéder à la génération de classe Java <code>simple</code> à partir des informations fournies par un fichier CSV.</p>

<p>Jusque là rien de magique, tout est fourni par FMPP.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#5bc4bf">package</span> <span style="color:#fec418">org.zenithar.app.service.events</span><span style="color:#5bc4bf">;</span>

<span style="color:#5bc4bf">import</span> <span style="color:#fec418">org.zentihar.app.dto.</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payloadType</span><span style="color:#5bc4bf">};</span>
<span style="color:#5bc4bf">import</span> <span style="color:#fec418">org.springframework.context.ApplicationEvent</span><span style="color:#5bc4bf">;</span>

<span style="color:#815ba4">public</span> <span style="color:#815ba4">final</span> <span style="color:#815ba4">class</span> <span style="color:#fec418">$</span><span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">entityName</span><span style="color:#5bc4bf">}</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">name</span><span style="color:#5bc4bf">}</span>Event <span style="color:#815ba4">extends</span> ApplicationEvent <span style="color:#5bc4bf">{</span>
  <span style="color:#815ba4">private</span> <span style="color:#815ba4">static</span> <span style="color:#815ba4">final</span> <span style="color:#fec418">long</span> serialVersionUID <span style="color:#5bc4bf">=</span> 1L<span style="color:#5bc4bf">;</span>

  <span style="color:#815ba4">private</span> $<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payloadType</span><span style="color:#5bc4bf">}</span> payload<span style="color:#5bc4bf">;</span>

  <span style="color:#815ba4">public</span> $<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">entityName</span><span style="color:#5bc4bf">}</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">name</span><span style="color:#5bc4bf">}</span>Event<span style="color:#5bc4bf">(</span>Object source<span style="color:#5bc4bf">,</span> $<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payloadType</span><span style="color:#5bc4bf">}</span> payload<span style="color:#5bc4bf">)</span> <span style="color:#5bc4bf">{</span>
    <span style="color:#815ba4">super</span><span style="color:#5bc4bf">(</span>source<span style="color:#5bc4bf">);</span>
    <span style="color:#815ba4">this</span><span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payload</span> <span style="color:#5bc4bf">=</span> payload<span style="color:#5bc4bf">;</span>
  <span style="color:#5bc4bf">}</span>

  <span style="color:#815ba4">public</span> $<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payloadType</span><span style="color:#5bc4bf">}</span> getPayload<span style="color:#5bc4bf">()</span> <span style="color:#5bc4bf">{</span>
    <span style="color:#815ba4">return</span> <span style="color:#815ba4">this</span><span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payload</span><span style="color:#5bc4bf">;</span>
  <span style="color:#5bc4bf">}</span> 
<span style="color:#5bc4bf">}</span></code></pre></div>
<p>Voici mon modèle pour une classe Java, cela représente un évènement Spring. Biensur il est tout à fait possible d&rsquo;utiliser l&rsquo;héritage ainsi que la généricité pour limiter la duplication de code.</p>

<h2 id="configuration-fmpp">Configuration FMPP</h2>

<p>Par défaut la génération via FreeMarker est <code>mono-fichier</code>, c&rsquo;est à dire qu&rsquo;un template
devient un et un seul fichier.</p>

<p>Il faut procéder à la configuration de FMPP, en modifiant de fichier <code>config.fmpp</code>,
<a href="http://fmpp.sourceforge.net/configfile.html">plusieurs formats de fichier de configuration</a>
peuvent être utilisés. J&rsquo;ai choisi d&rsquo;utilisé le format TDD, qui resemble beaucoup au format
JSON.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#06b6ef">data</span><span style="color:#5bc4bf">:</span> <span style="color:#06b6ef">events</span><span style="color:#5bc4bf">:</span><span style="color:#06b6ef">csv</span>(..<span style="color:#ef6155">/data/events.csv)</span></code></pre></div>
<p>Ce fichier va définir les sources de données utilisées <code>data</code>, remarquez la syntaxe :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">data: &lt;<span style="color:#5bc4bf">collection</span>&gt;:&lt;<span style="color:#5bc4bf">loader</span>&gt;(&lt;<span style="color:#5bc4bf">source</span>&gt;)</code></pre></div>
<p>Cette configuration va charger le fichier <code>../data/events.csv</code>, à l&rsquo;aide du loader <code>csv</code> afin de produire une collection nommée <code>events</code>. C&rsquo;est à dire que dans notre template il y aura une collection appelée <code>events</code> exploitable par le langage FreeMarker.</p>

<h2 id="préparation-des-données">Préparation des données</h2>

<p>Pour exploiter une source de données de type séquence, il faut utiliser :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ef6155">&lt;</span>#list events as event&gt;
  ${event.name}
<span style="color:#ef6155">&lt;</span>/#list&gt;</code></pre></div>
<p>Vous avez remarqué que <code>event</code> est considéré comme un objet avec des propriétés, et bien dans le cadre du loader CSV, il s&rsquo;agit tout simplement du nom de colonne renseignée dans le fichier :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">entityName;name;payloadType
User;Created;UserDTO
User;Deleted;UserDTO</code></pre></div>
<p>[info] !!! ATTENTION de ne pas oublier le dernier retour à la ligne !!! [/info]</p>

<h2 id="génération-multi-fichiers">Génération multi-fichiers</h2>

<p>La fusion du template avec les données va donc produire une suite d&rsquo;évènement, jusque là
tout va bien, seul problème, tout est généré dans un seul fichier portant le nom du template !</p>

<p>Pour cela il faut utiliser des directives fmpp supplémentaires, ce qui donnera au final le
template suivant :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#5bc4bf">&lt;</span><span style="color:#5bc4bf">@pp.dropOutputFile</span> <span style="color:#5bc4bf">/&gt;</span> 
<span style="color:#5bc4bf">&lt;</span><span style="color:#ef6155">#</span>list events as event<span style="color:#5bc4bf">&gt;</span>
<span style="color:#5bc4bf">&lt;</span><span style="color:#5bc4bf">@pp.changeOutputFile</span> name<span style="color:#5bc4bf">=</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">entityName</span><span style="color:#5bc4bf">}+</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">name</span><span style="color:#5bc4bf">}+</span><span style="color:#48b685">&#34;Event.java&#34;</span> <span style="color:#5bc4bf">/&gt;</span>
<span style="color:#5bc4bf">package</span> <span style="color:#fec418">org.zenithar.app.service.events</span><span style="color:#5bc4bf">;</span>

<span style="color:#5bc4bf">import</span> <span style="color:#fec418">org.zenithar.app.service.events.AbstractEvent</span><span style="color:#5bc4bf">;</span>
<span style="color:#5bc4bf">import</span> <span style="color:#fec418">org.zenithar.app.service.dto.</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payloadType</span><span style="color:#5bc4bf">};</span>

<span style="color:#5bc4bf">import</span> <span style="color:#fec418">org.springframework.context.ApplicationEvent</span><span style="color:#5bc4bf">;</span>

<span style="color:#815ba4">public</span> <span style="color:#815ba4">final</span> <span style="color:#815ba4">class</span> <span style="color:#fec418">$</span><span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">entityName</span><span style="color:#5bc4bf">}</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">name</span><span style="color:#5bc4bf">}</span>Event <span style="color:#815ba4">extends</span> AbstractEvent<span style="color:#5bc4bf">&lt;</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payloadType</span><span style="color:#5bc4bf">}&gt;</span> <span style="color:#5bc4bf">{</span>
  <span style="color:#815ba4">private</span> <span style="color:#815ba4">static</span> <span style="color:#815ba4">final</span> <span style="color:#fec418">long</span> serialVersionUID <span style="color:#5bc4bf">=</span> 1L<span style="color:#5bc4bf">;</span>

  <span style="color:#815ba4">public</span> $<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">entityName</span><span style="color:#5bc4bf">}</span>$<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">name</span><span style="color:#5bc4bf">}</span>Event<span style="color:#5bc4bf">(</span>Object source<span style="color:#5bc4bf">,</span> $<span style="color:#5bc4bf">{</span>event<span style="color:#5bc4bf">.</span><span style="color:#06b6ef">payloadType</span><span style="color:#5bc4bf">}</span> payload<span style="color:#5bc4bf">)</span> <span style="color:#5bc4bf">{</span>
    <span style="color:#815ba4">super</span><span style="color:#5bc4bf">(</span>source<span style="color:#5bc4bf">,</span> payload<span style="color:#5bc4bf">);</span>
  <span style="color:#5bc4bf">}</span>
<span style="color:#5bc4bf">}</span>
<span style="color:#5bc4bf">&lt;/</span><span style="color:#ef6155">#</span>list<span style="color:#5bc4bf">&gt;</span></code></pre></div>
<p>Ce template produira autant de fichier qu&rsquo;il y a de lignes dans la collection.</p>

<p>A l&rsquo;exécution de la commande :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; mvn clean package</code></pre></div>
<p>Le plugin FMPP sera invoqué, génèrera les fichiers, ils seront compilés, puis intégrés dans l&rsquo;artefact généré.</p>

<h1 id="conclusion">Conclusion</h1>

<p>Et voila ! Vous possédez un micro générateur de code, ce n&rsquo;est pas du MDA type UML + M2T avec <a href="http://www.acceleo.org/">Acceleo</a> ou équivalent, mais ça peut dépanner pour des générations simples.</p>
</div>

    
    

    

    

</main>

        <footer>

            <p class="copyright text-muted">Geo Joy &copy; All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a> hosted on <a href="https://github.com/Geo-Joy/geo-joy.github.io">Github</a></p>

        </footer>
        
       <script async="" src="http://geojoy.me/js/main.js"></script>

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KQ3JDPK');</script>


    </body>

</html>

