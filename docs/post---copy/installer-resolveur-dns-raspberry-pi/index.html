<!DOCTYPE html>
<html lang="en-us" class="wf-loading">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="preload" href="/https://geojoy.mejs/main.js" as="script" />
        <link rel="preload" href="/https://geojoy.mecss/main.css" as="style" />

        <title>Installer un resolveur DNS sur son Raspberry PI</title>
        <meta name="generator" content="Hugo 0.32.4" />
        
        <link rel="preconnect" href="https://ajax.googleapis.com/" crossorigin>
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
        <meta property="og:title" content="Installer un resolveur DNS sur son Raspberry PI" />
<meta property="og:description" content="Installer unbound &#43; dnscrypt sur son raspberry pi." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://geojoy.me/post---copy/installer-resolveur-dns-raspberry-pi/" />



<meta property="article:published_time" content="2015-08-11T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-03-01T11:27:29&#43;01:00"/>











    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2015-08-11T00:00:00Z" />
        <meta property="og:article:tag" content="dns" />
        <meta property="og:article:tag" content="infrastructure" />
        <meta property="og:article:tag" content="raspberry" />
        
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@megeojoy" />
        <meta name="twitter:creator" content="@megeojoy" />
        <meta name="twitter:title" content="Installer un resolveur DNS sur son Raspberry PI" />
        <meta name="twitter:description" content="Installer unbound &#43; dnscrypt sur son raspberry pi." />
        <meta name="twitter:url" content="https://geojoy.me/post---copy/installer-resolveur-dns-raspberry-pi/" />
        <meta name="twitter:image" content="https://geojoy.me/images/raspberry-pi-2.jpg">
    

    
        <meta name="p:domain_verify" content="fc173d84e3a4de948ed4bda2908afd3e"/>
    

    
    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Geo Joy",
      "url": "http://geojoy.me",
      "sameAs": [
        "https://twitter.com/megeojoy",
        "https://www.linkedin.com/in/geojoy/",
        "https://github.com/Geo-Joy",
      ],
      "image": {
        "@type": "ImageObject",
        "url": "https://geojoy.me/images/avatar.jpg",
        "height": 80,
        "width": 80
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "@id": "https://geojoy.me",
      "name": "Geo&#39;z Blog",
      "url": "https://geojoy.me",
      "logo": {
        "@type": "ImageObject",
        "url": "https://geojoy.me/images/avatar.jpg",
        "height": 80,
        "width": 80
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "url": "https://geojoy.me",
      "name": "Geo&#39;z Blog",
      "author": {
        "@type": "Person",
        "name": "Geo Joy"
      },
      "description": ""
    }
    </script>

      
      <script type="application/ld+json">
      {
          "@context": "http://schema.org",
          "@type": "BlogPosting",
          "headline": "Installer un resolveur DNS sur son Raspberry PI",
          "description": "Installer unbound &#43; dnscrypt sur son raspberry pi.",
          "author": {
              "@type": "Person",
              "name": "Geo Joy"
          },
          "publisher": {
              "@type": "Organization",
              "name": "Geo&#39;z Blog",
              "logo": "https://geojoy.me/images/avatar.jpg"
          },
          "image": {
            "@type": "ImageObject",
            "url": "https://geojoy.me/images/raspberry-pi-2.jpg",
            "height": 133,
            "width": 200
          },
          "datePublished": "2015-08-11",
          "dateModified": "2017-03-01",
          "wordCount": 1058
          ,
          "keywords": ["dns","infrastructure","raspberry"] 
      }
    </script>
  

    <style>
body{margin:0}main,nav{display:block}a{background-color:transparent}h1{margin:.67em 0;font-size:2em}img{border:0}code,kbd{font-family:monospace,monospace;font-size:1em}button{margin:0;font:inherit;color:inherit}button{overflow:visible}button{text-transform:none}button{-webkit-appearance:button}button::-moz-focus-inner{padding:0;border:0}*{-webkit-box-sizing:border-box;box-sizing:border-box}:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box}html{font-size:10px}body{font-family:"Raleway",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}button{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#337ab7;text-decoration:none}img{vertical-align:middle}h1,h4,h5{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}h1{margin-top:20px;margin-bottom:10px}h4,h5{margin-top:10px;margin-bottom:10px}h1{font-size:36px}h4{font-size:18px}h5{font-size:14px}p{margin:0 0 10px}.text-justify{text-align:justify}ul{margin-top:0;margin-bottom:10px}blockquote{padding:10px 20px;margin:0 0 20px;font-size:17.5px;border-left:5px solid #eee}blockquote p:last-child{margin-bottom:0}code,kbd{font-family:Menlo,Monaco,Consolas,"Courier New",monospace}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:4px}kbd{padding:2px 4px;font-size:90%;color:#fff;background-color:#333;border-radius:3px;-webkit-box-shadow:inset 0 -1px 0 rgba(0,0,0,.25);box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}.container{padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media (min-width:768px){.container{width:750px}}@media (min-width:992px){.container{width:970px}}@media (min-width:1200px){.container{width:1170px}}.collapse{display:none}.nav{padding-left:0;margin-bottom:0;list-style:none}.nav>li{position:relative;display:block}.nav>li>a{position:relative;display:block;padding:10px 15px}.navbar{position:relative;min-height:50px;margin-bottom:20px;border:1px solid transparent}@media (min-width:768px){.navbar{border-radius:4px}}@media (min-width:768px){.navbar-header{float:left}}.navbar-collapse{padding-right:15px;padding-left:15px;overflow-x:visible;-webkit-overflow-scrolling:touch;border-top:1px solid transparent;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,.1);box-shadow:inset 0 1px 0 rgba(255,255,255,.1)}@media (min-width:768px){.navbar-collapse{width:auto;border-top:0;-webkit-box-shadow:none;box-shadow:none}.navbar-collapse.collapse{display:block !important;height:auto !important;padding-bottom:0;overflow:visible !important}.navbar-fixed-top .navbar-collapse{padding-right:0;padding-left:0}}.navbar-fixed-top .navbar-collapse{max-height:340px}@media (max-device-width:480px) and (orientation:landscape){.navbar-fixed-top .navbar-collapse{max-height:200px}}.container>.navbar-collapse,.container>.navbar-header{margin-right:-15px;margin-left:-15px}@media (min-width:768px){.container>.navbar-collapse,.container>.navbar-header{margin-right:0;margin-left:0}}.navbar-fixed-top{position:fixed;right:0;left:0;z-index:1030}@media (min-width:768px){.navbar-fixed-top{border-radius:0}}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-brand{float:left;height:50px;padding:15px 15px;font-size:18px;line-height:20px}@media (min-width:768px){.navbar>.container .navbar-brand{margin-left:-15px}}.navbar-toggle{position:relative;float:right;padding:9px 10px;margin-top:8px;margin-right:15px;margin-bottom:8px;background-color:transparent;background-image:none;border:1px solid transparent;border-radius:4px}.navbar-toggle .icon-bar{display:block;width:22px;height:2px;border-radius:1px}.navbar-toggle .icon-bar+.icon-bar{margin-top:4px}@media (min-width:768px){.navbar-toggle{display:none}}.navbar-nav{margin:7.5px -15px}.navbar-nav>li>a{padding-top:10px;padding-bottom:10px;line-height:20px}@media (min-width:768px){.navbar-nav{float:left;margin:0}.navbar-nav>li{float:left}.navbar-nav>li>a{padding-top:15px;padding-bottom:15px}}@media (min-width:768px){.navbar-right{float:right !important;margin-right:-15px}}.navbar-default{background-color:#f8f8f8;border-color:#e7e7e7}.navbar-default .navbar-brand{color:#777}.navbar-default .navbar-nav>li>a{color:#777}.navbar-default .navbar-toggle{border-color:#ddd}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse{border-color:#e7e7e7}.container:after,.container:before,.nav:after,.nav:before,.navbar-collapse:after,.navbar-collapse:before,.navbar-header:after,.navbar-header:before,.navbar:after,.navbar:before{display:table;content:" "}.container:after,.nav:after,.navbar-collapse:after,.navbar-header:after,.navbar:after{clear:both}@-ms-viewport{width:device-width}.visible-xs{display:none !important}@media (max-width:767px){.visible-xs{display:block !important}}html{height:100%}body{height:100%;padding-top:55px;display:-webkit-box;display:-ms-flexbox;display:flex;text-align:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;font-size:16px !important}main{margin:auto;padding:25px;max-width:750px}a:link,a:visited{color:green}.item{padding:10px 0}.item-tag{background-color:green}.navbar-icon{font-size:125%;display:inline-block !important}.navbar.navbar-default{border-top:5px solid green}img{max-width:100%}.fade-in{opacity:0}
.wf-loading p, .wf-loading h1, .wf-loading h2, .wf-loading h3, .wf-loading h4, .wf-loading a {visibility: hidden;}.wf-active  p, .wf-active h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active a {visibility: visible;}.wf-inactive    p, .wf-inactive h1, .wf-inactive h2, .wf-inactive h3, .wf-inactive h4, wf-inactive a {visibility: visible;}
</style>

    </head>

    <body>
      
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQ3JDPK"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      

        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Installer un resolveur DNS sur son Raspberry PI</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/project/">Projects</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="/resume/"><i class="fa fa-user"></i></a></li>
                            
                                <li class="navbar-icon"><a href="http://www.google.com/recaptcha/mailhide/d?k=01IIc-s5LNYiS-CG_gthn4PA==&amp;c=r5Ctx8RMDz422qmYESfk1g=="><i class="fa fa-envelope"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/Geo-Joy"><i class="fa fa-github-alt"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/megeojoy"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/geojoy/"><i class="fa fa-linkedin"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main class="fade-in">

    <div class="item">

    
    
    

    
      

    <h4><a itemprop="url" href="/post---copy/installer-resolveur-dns-raspberry-pi/">
      <span itemprop="name">Installer un resolveur DNS sur son Raspberry PI</span>
    </a></h4>

    August 11, 2015
    <h5>Installer unbound &#43; dnscrypt sur son raspberry pi.</h5>
     <a href="../../../../../tags/dns"><kbd class="item-tag">dns</kbd></a>  <a href="../../../../../tags/infrastructure"><kbd class="item-tag">infrastructure</kbd></a>  <a href="../../../../../tags/raspberry"><kbd class="item-tag">raspberry</kbd></a> 

</div>


    <br> <div class="text-justify">

<p>Afin d&rsquo;optimiser et de fiabiliser votre accès internet à la maison, je vous propose d&rsquo;installer un resolveur DNS <code>unbound</code> comme relai à <code>dnscrypt-proxy</code> permettant de faire des requêtes DNS chiffrées (en attendant la généralisation de DNSSEC).</p>

<p>Pour cela, vous aurez besoin :</p>

<ul>
<li>D&rsquo;un raspberry pi (1 ou 2);</li>
<li>Archlinux installé sur le raspberry;</li>
<li>de temps.</li>
</ul>

<h2 id="dnscrypt-c-est-quoi">DNSCrypt c&rsquo;est quoi ? :</h2>

<p><a href="http://dnscrypt.org/">DNSCrypt</a> est un protocole qui tente de sécuriser le protocole DNS à l&rsquo;aide de la librairie <a href="https://github.com/jedisct1/libsodium">Sodium</a> (NaCl), utilisée notamment dans le chiffrement et l&rsquo;authentification pour <a href="http://zeromq.org/">ZMQ</a>.</p>

<p>Le protocole DNSCrypt utilise un résolveur sur internet avec lequel il communique en utilisant les ports TCP 443, et UDP 443, souvent moins filtrés par les firewall et/ou fournisseurs d&rsquo;accès internet.</p>

<p>Il faut installer un <code>agent</code> local qui va transférer en chiffré les requêtes DNS au serveur DNSCrypt qui va résoudre et retransmettre les réponses en chiffré à l&rsquo;agent.</p>

<blockquote>
<p>(local host) &lt;&ndash; [dns] &ndash;&gt; (agent) &lt;&ndash; [dnscrypt] -&gt; (server) &lt;&ndash; [dns] &ndash;&gt; (resolver)</p>
</blockquote>

<p>C&rsquo;est un peu comme si on faisait passer les requêtes DNS dans un VPN pour masquer le traffic. Ou plutôt HTTP est au DNS, ce que HTTPS est à DNSCrypt.
Ce tunneling permet d&rsquo;éviter les soucis de <code>man in the middle</code> et d&rsquo;espionnage de trame.</p>

<p>DNSCrypt ne remplace pas <a href="https://fr.wikipedia.org/wiki/Domain_Name_System_Security_Extensions">DNSSEC</a>, mais peut être utilisé en parallèle. DNSSEC permet entre autres de vérifier qu’un enregistrement n’a pas été modifié, alors que DNSCrypt ne permet que de protéger la vie privée d’un utilisateur en chiffrant le contenu des requêtes DNS envoyées vers le serveur de noms.</p>

<p>Dans notre cas nous utiliserons DNSCrypt comme système de résolution distant.</p>

<h2 id="unbound-c-est-quoi">Unbound c&rsquo;est quoi ?</h2>

<p><a href="https://www.unbound.net/">Unbound</a> est un serveur DNS faisant office de :</p>

<ul>
<li>cache pour diminuer le temps de résolution;</li>
<li>d&rsquo;autorité locale pour la résolution locale (zone locale);</li>
<li>passerelle de validation DNSSEC.</li>
</ul>

<p>Vous me direz, biensûr, mais il y a <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> aussi &hellip; certes &hellip; mais là je parle de unbound !</p>

<p>Avec unbound, on a la possibilité de le configurer pour aller consulter les serveurs DNS ROOT (La matrice de l&rsquo;internet ! Les alpha serveurs.)</p>

<p>Le service DNS est hiérarchisé en arbre. Par exemple :</p>

<ul>
<li><code>blog.zenithar.org</code> est en fait <code>blog.zenithar.org.ROOT</code></li>
</ul>

<p>C&rsquo;est à dire qu&rsquo;il existe un service DNS permettant de diriger les requêtes de plus bas niveau vers des serveurs DNS d&rsquo;une autre branche.</p>

<p>Pour résoudre <code>zenithar.org</code> :</p>

<ul>
<li>Mon ordinateur demande au DNS local de résoudre <code>zenithar.org</code>, mais ne connait pas la réponse;</li>
<li>Il contacte le DNS de mon fournisseur d&rsquo;accès, mais ne connait pas la réponse;</li>
<li>Il contacte le DNS racine qui le dirige sur le serveur DNS détenant le domaine, qui réponds;</li>
<li>Réponds au serveur DNS de mon FAI, qui mets la réponse en cache;</li>
<li>Réponds à mon forwarder local qui me réponds.</li>
</ul>

<p>On parle alors de <code>forwarder</code> puisque mon résolveur local fait <code>confiance</code> au DNS parent auquel il est configuré.</p>

<p>Le problème est que si le DNS du FAI vient falsifier la réponse, vous n&rsquo;aurez aucune preuve de la mauvaise fois du serveur DNS du FAI sans DNSSEC.
Le principe de DNSSEC est en gros de signer les requêtes et les réponses pour garantir la non-répudiation d&rsquo;un requête DNS.</p>

<p>Nous allons donc mettre en place unbound avec les mécanismes DNSSEC afin de garantir (quand le domaine le supporte) les échanges DNS.</p>

<h2 id="installation-de-unbound">Installation de Unbound</h2>

<p>Tout d&rsquo;abord veuillez procéder à l&rsquo;installation du service Unboud sur votre Raspberry PI.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; pacman -S unbound
$&gt; systemctl enable unbound</code></pre></div>
<p>Il faut ensuite configurer le service avec le fichier de configuration (<code>/etc/unbound</code>) suivant :</p>

<code data-gist-id="f2052d4174f592e0083f" data-gist-file="unbound.conf"></code>


<p>Vous pouvez configurer une zone locale c&rsquo;est-à-dire que vous pouvez donner à vos machines un nom DNS local privé à votre zone.</p>

<code data-gist-id="f2052d4174f592e0083f" data-gist-file="forward.conf"></code>


<p>Il faut aussi configurer le reverse dns qui permet depuis une IP d&rsquo;obtenir le DNS associé :</p>

<code data-gist-id="f2052d4174f592e0083f" data-gist-file="reverse.conf"></code>


<p>Cette configuration permet de mettre en place un serveur DNS local pour un réseau mappé en 192.168.0.0/24, et utilise les DNS de OpenDNS comme résolveur distant.
Vous n&rsquo;utiliserez plus les DNS de vos fournisseurs d&rsquo;accès, cependant il est possible que l&rsquo;accès soit restreint, voir contrôlé, il faut donc mettre en place le chiffrement du traffic DNS à l&rsquo;aide du proxy DNSCrypt.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; systemctl start unbound</code></pre></div>
<h2 id="installation-de-dnscrypt">Installation de DNSCrypt</h2>

<p>Nous allons mettre en place le service <code>dnscrypt-proxy</code> sur le Raspberry PI.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; pacman -S dnscrypt-proxy
$&gt; systemctl enable dnscrypt-proxy</code></pre></div>
<p>Vous devez procéder à la configuration (<code>/etc/conf.d/dnscrypt-proxy</code>) du proxy DNS :</p>

<code data-gist-id="f2052d4174f592e0083f" data-gist-file="dnscrypt-proxy"></code>


<p>Il suffit de démarrer votre relai DNSCrypt.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; systemctl start dnscrypt-proxy</code></pre></div>
<h2 id="pour-terminer">Pour terminer</h2>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; netstat -lnp</code></pre></div>
<p>Vous devriez voir les services <code>unbound</code> et <code>dnscrypt-proxy</code> s&rsquo;exécuter.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">udp   <span style="color:#f99b15">0</span> <span style="color:#f99b15">0</span> <span style="color:#f99b15">0</span>.0.0.0:53       <span style="color:#f99b15">0</span>.0.0.0:*   LISTEN      ****/unbound
tcp   <span style="color:#f99b15">0</span> <span style="color:#f99b15">0</span> <span style="color:#f99b15">127</span>.0.0.1:9053   <span style="color:#f99b15">0</span>.0.0.0:*   LISTEN      ****/dnscrypt-proxy
udp   <span style="color:#f99b15">0</span> <span style="color:#f99b15">0</span> <span style="color:#f99b15">127</span>.0.0.1:9053   <span style="color:#f99b15">0</span>.0.0.0:*               ****/dnscrypt-proxy</code></pre></div>
<p>Il suffit de décommenter la ligne 81 de unbound.conf, et de commenter les forward sur OpenDNS.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; systemctl restart unbound</code></pre></div>
<h2 id="quelques-tests">Quelques tests</h2>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; drill -D zenithar.org</code></pre></div>
<p>Vous devriez voir les requêtes ainsi que la résolution DNSSEC effectuée par Unbound au travers de DNSCrypt.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; drill router.home</code></pre></div>
<p>Vous devriez voir l&rsquo;adresse IP résolue configurée dans vore zone locale.</p>

<p>Si tout fonctionne bien, votre résolveur DNS local est configuré. Si vous souhaitez définir le résolveur local comme résolveur par défaut pour votre réseau, ce qui rendra votre RPI indispensable à l&rsquo;infrastructure locale, vous devez configurer votre serveur DHCP (la box) pour fournir en serveur DNS l&rsquo;adresse IP (au préalable fixée) de votre résolveur local.</p>

<h1 id="problèmes">Problèmes</h1>

<h3 id="vous-venez-de-faire-la-mise-à-jour-et-maintenant-dnscrypt-fonctionne-avec-systemd">Vous venez de faire la mise à jour et maintenant DNSCrypt fonctionne avec Systemd ?</h3>

<p>Il suffit d&rsquo;éditer le fichier <code>/usr/lib/systemd/system/dnscrypt-proxy.socket</code></p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#815ba4">[Unit]</span>
<span style="color:#06b6ef">Description</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">dnscrypt-proxy listening socket</span>
<span style="color:#06b6ef">After</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">network.target</span>

<span style="color:#815ba4">[Socket]</span>
<span style="color:#06b6ef">ListenStream</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">127.0.0.1:9053</span>
<span style="color:#06b6ef">ListenDatagram</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">127.0.0.1:9053</span>

<span style="color:#815ba4">[Install]</span>
<span style="color:#06b6ef">WantedBy</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">sockets.target</span></code></pre></div>
<p>Ainsi que le fichier de service <code>/usr/lib/systemd/system/dnscrypt-proxy.service</code> :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#815ba4">[Unit]</span>
<span style="color:#06b6ef">Description</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">DNSCrypt client proxy</span>
<span style="color:#06b6ef">Requires</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">dnscrypt-proxy.socket</span>
<span style="color:#06b6ef">Before</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">unbound.service</span>

<span style="color:#815ba4">[Install]</span>
<span style="color:#06b6ef">Also</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">dnscrypt-proxy.socket</span>
<span style="color:#06b6ef">WantedBy</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">multi-user.target</span>

<span style="color:#815ba4">[Service]</span>
<span style="color:#06b6ef">Type</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">simple</span>
<span style="color:#06b6ef">NonBlocking</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">true</span>
<span style="color:#06b6ef">ExecStart</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">/usr/bin/dnscrypt-proxy \
</span><span style="color:#48b685">	       --resolver-name=dnscrypt.org-fr</span></code></pre></div>
<p>Un petit reload des services :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$&gt; systemctl daemon-reload
$&gt; systemctl restart dnscrypt-proxy
$&gt; systemctl restart unbound</code></pre></div>
<p>Et refaire les tests.</p>

<h3 id="mon-raspberry-n-arrive-plus-à-avoir-l-heure-correctement-au-démarrage">Mon Raspberry n&rsquo;arrive plus à avoir l&rsquo;heure correctement au démarrage :</h3>

<p>Pour cela, j&rsquo;ai une solution un peu crade mais elle fonctionne, il faut éditer
le fichier <code>/etc/ntp.conf</code> et y remplacer les DNS par les IPs des pool utilisés :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#776e71"># Associate to Arch&#39;s NTP pool</span>
<span style="color:#06b6ef">server 195.154.97.57 # 0.arch.pool.ntp.org</span>
<span style="color:#06b6ef">server 212.83.131.33 # 0.arch.pool.ntp.org</span>
<span style="color:#06b6ef">server 91.121.90.6   # 0.arch.pool.ntp.org</span>
<span style="color:#06b6ef">server 188.165.39.130 # 0.arch.pool.ntp.org</span>
<span style="color:#776e71"># Il faudrait le faire pour chaque serveur ...</span></code></pre></div>
<p>Ce problème peut aussi être simplement résolu (moyennant finance) par l&rsquo;achat
d&rsquo;une carte d&rsquo;extension avec une horloge interne - <a href="http://www.framboise314.fr/avant-lheure-cest-pas-lheure-apres-lheure-offrez-une-horloge-temps-reel-rtc-a-votre-raspberry-pi/">Avant l’heure, c’est pas l’heure ! Après l’heure… Offrez une horloge temps réel (RTC) à votre Raspberry Pi
</a>.</p>
</div>

    
    

    
        <h4 class="page-header">Related</h4>
        
          <div class="item">

    
    
    

    
      

    <h4><a itemprop="url" href="/post/2018/01/17/test-description/">
      <span itemprop="name">Test1</span>
    </a></h4>

    January 17, 2018
    <h5>test description</h5>
     <a href="../../../../../tags/python"><kbd class="item-tag">python</kbd></a>  <a href="../../../../../tags/mopidy"><kbd class="item-tag">mopidy</kbd></a>  <a href="../../../../../tags/raspberry"><kbd class="item-tag">raspberry</kbd></a>  <a href="../../../../../tags/linux"><kbd class="item-tag">linux</kbd></a>  <a href="../../../../../tags/spotify"><kbd class="item-tag">spotify</kbd></a> 

</div>

        
    

    

</main>

        <footer>

            <p class="copyright text-muted">Geo Joy &copy; All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a> hosted on <a href="https://github.com/Geo-Joy/geo-joy.github.io">Github</a></p>

        </footer>
        
       <script async="" src="https://geojoy.mejs/main.js"></script>

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KQ3JDPK');</script>


    </body>

</html>

