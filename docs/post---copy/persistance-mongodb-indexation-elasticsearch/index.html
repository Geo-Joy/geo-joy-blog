<!DOCTYPE html>
<html lang="en-us" class="wf-loading">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="preload" href="http://geojoy.me/js/main.js" as="script" />
        <link rel="preload" href="http://geojoy.me/css/main.css" as="style" />

        <title>Persistance MongoDB, et indexation ElasticSearch</title>
        <meta name="generator" content="Hugo 0.32.4" />
        
        <link rel="preconnect" href="https://ajax.googleapis.com/" crossorigin>
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
        <meta property="og:title" content="Persistance MongoDB, et indexation ElasticSearch" />
<meta property="og:description" content="Utilisation du concept des &#39;rivers&#39; ElasticSearch pour indexer une base MongoDB." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://geojoy.me/post---copy/persistance-mongodb-indexation-elasticsearch/" />



<meta property="article:published_time" content="2013-10-19T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-03-01T11:27:28&#43;01:00"/>











    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2013-10-19T00:00:00Z" />
        <meta property="og:article:tag" content="elasticsearch" />
        <meta property="og:article:tag" content="mongodb" />
        <meta property="og:article:tag" content="river" />
        
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@megeojoy" />
        <meta name="twitter:creator" content="@megeojoy" />
        <meta name="twitter:title" content="Persistance MongoDB, et indexation ElasticSearch" />
        <meta name="twitter:description" content="Utilisation du concept des &#39;rivers&#39; ElasticSearch pour indexer une base MongoDB." />
        <meta name="twitter:url" content="http://geojoy.me/post---copy/persistance-mongodb-indexation-elasticsearch/" />
        <meta name="twitter:image" content="http://geojoy.me/images/mongodb-to-elasticsearch2.png">
    

    
        <meta name="p:domain_verify" content="58lHJFznHgioHOIv2NvLfobc8XEUUZSKm016uFFO4vE"/>
    

    
    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Geo Joy",
      "url": "http://geojoy.me",
      "sameAs": [
        "https://twitter.com/megeojoy",
        "https://www.linkedin.com/in/geojoy/",
        "https://github.com/Geo-Joy",
      ],
      "image": {
        "@type": "ImageObject",
        "url": "https://geojoy.me/images/avatar.jpg",
        "height": 80,
        "width": 80
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "@id": "http://geojoy.me",
      "name": "Geo&#39;z Blog",
      "url": "http://geojoy.me",
      "logo": {
        "@type": "ImageObject",
        "url": "https://geojoy.me/images/avatar.jpg",
        "height": 80,
        "width": 80
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "url": "http://geojoy.me",
      "name": "Geo&#39;z Blog",
      "author": {
        "@type": "Person",
        "name": "Geo Joy"
      },
      "description": ""
    }
    </script>

      
      <script type="application/ld+json">
      {
          "@context": "http://schema.org",
          "@type": "BlogPosting",
          "headline": "Persistance MongoDB, et indexation ElasticSearch",
          "description": "Utilisation du concept des &#39;rivers&#39; ElasticSearch pour indexer une base MongoDB.",
          "author": {
              "@type": "Person",
              "name": "Geo Joy"
          },
          "publisher": {
              "@type": "Organization",
              "name": "Geo&#39;z Blog",
              "logo": "https://geojoy.me/images/avatar.jpg"
          },
          "image": {
            "@type": "ImageObject",
            "url": "http://geojoy.me/images/mongodb-to-elasticsearch2.png",
            "height": 133,
            "width": 200
          },
          "datePublished": "2013-10-19",
          "dateModified": "2017-03-01",
          "wordCount": 978
          ,
          "keywords": ["elasticsearch","mongodb","river"] 
      }
    </script>
  

    <style>
body{margin:0}main,nav{display:block}a{background-color:transparent}h1{margin:.67em 0;font-size:2em}img{border:0}code,kbd{font-family:monospace,monospace;font-size:1em}button{margin:0;font:inherit;color:inherit}button{overflow:visible}button{text-transform:none}button{-webkit-appearance:button}button::-moz-focus-inner{padding:0;border:0}*{-webkit-box-sizing:border-box;box-sizing:border-box}:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box}html{font-size:10px}body{font-family:"Raleway",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}button{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#337ab7;text-decoration:none}img{vertical-align:middle}h1,h4,h5{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}h1{margin-top:20px;margin-bottom:10px}h4,h5{margin-top:10px;margin-bottom:10px}h1{font-size:36px}h4{font-size:18px}h5{font-size:14px}p{margin:0 0 10px}.text-justify{text-align:justify}ul{margin-top:0;margin-bottom:10px}blockquote{padding:10px 20px;margin:0 0 20px;font-size:17.5px;border-left:5px solid #eee}blockquote p:last-child{margin-bottom:0}code,kbd{font-family:Menlo,Monaco,Consolas,"Courier New",monospace}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:4px}kbd{padding:2px 4px;font-size:90%;color:#fff;background-color:#333;border-radius:3px;-webkit-box-shadow:inset 0 -1px 0 rgba(0,0,0,.25);box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}.container{padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media (min-width:768px){.container{width:750px}}@media (min-width:992px){.container{width:970px}}@media (min-width:1200px){.container{width:1170px}}.collapse{display:none}.nav{padding-left:0;margin-bottom:0;list-style:none}.nav>li{position:relative;display:block}.nav>li>a{position:relative;display:block;padding:10px 15px}.navbar{position:relative;min-height:50px;margin-bottom:20px;border:1px solid transparent}@media (min-width:768px){.navbar{border-radius:4px}}@media (min-width:768px){.navbar-header{float:left}}.navbar-collapse{padding-right:15px;padding-left:15px;overflow-x:visible;-webkit-overflow-scrolling:touch;border-top:1px solid transparent;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,.1);box-shadow:inset 0 1px 0 rgba(255,255,255,.1)}@media (min-width:768px){.navbar-collapse{width:auto;border-top:0;-webkit-box-shadow:none;box-shadow:none}.navbar-collapse.collapse{display:block !important;height:auto !important;padding-bottom:0;overflow:visible !important}.navbar-fixed-top .navbar-collapse{padding-right:0;padding-left:0}}.navbar-fixed-top .navbar-collapse{max-height:340px}@media (max-device-width:480px) and (orientation:landscape){.navbar-fixed-top .navbar-collapse{max-height:200px}}.container>.navbar-collapse,.container>.navbar-header{margin-right:-15px;margin-left:-15px}@media (min-width:768px){.container>.navbar-collapse,.container>.navbar-header{margin-right:0;margin-left:0}}.navbar-fixed-top{position:fixed;right:0;left:0;z-index:1030}@media (min-width:768px){.navbar-fixed-top{border-radius:0}}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-brand{float:left;height:50px;padding:15px 15px;font-size:18px;line-height:20px}@media (min-width:768px){.navbar>.container .navbar-brand{margin-left:-15px}}.navbar-toggle{position:relative;float:right;padding:9px 10px;margin-top:8px;margin-right:15px;margin-bottom:8px;background-color:transparent;background-image:none;border:1px solid transparent;border-radius:4px}.navbar-toggle .icon-bar{display:block;width:22px;height:2px;border-radius:1px}.navbar-toggle .icon-bar+.icon-bar{margin-top:4px}@media (min-width:768px){.navbar-toggle{display:none}}.navbar-nav{margin:7.5px -15px}.navbar-nav>li>a{padding-top:10px;padding-bottom:10px;line-height:20px}@media (min-width:768px){.navbar-nav{float:left;margin:0}.navbar-nav>li{float:left}.navbar-nav>li>a{padding-top:15px;padding-bottom:15px}}@media (min-width:768px){.navbar-right{float:right !important;margin-right:-15px}}.navbar-default{background-color:#f8f8f8;border-color:#e7e7e7}.navbar-default .navbar-brand{color:#777}.navbar-default .navbar-nav>li>a{color:#777}.navbar-default .navbar-toggle{border-color:#ddd}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse{border-color:#e7e7e7}.container:after,.container:before,.nav:after,.nav:before,.navbar-collapse:after,.navbar-collapse:before,.navbar-header:after,.navbar-header:before,.navbar:after,.navbar:before{display:table;content:" "}.container:after,.nav:after,.navbar-collapse:after,.navbar-header:after,.navbar:after{clear:both}@-ms-viewport{width:device-width}.visible-xs{display:none !important}@media (max-width:767px){.visible-xs{display:block !important}}html{height:100%}body{height:100%;padding-top:55px;display:-webkit-box;display:-ms-flexbox;display:flex;text-align:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;font-size:16px !important}main{margin:auto;padding:25px;max-width:750px}a:link,a:visited{color:green}.item{padding:10px 0}.item-tag{background-color:green}.navbar-icon{font-size:125%;display:inline-block !important}.navbar.navbar-default{border-top:5px solid green}img{max-width:100%}.fade-in{opacity:0}
.wf-loading p, .wf-loading h1, .wf-loading h2, .wf-loading h3, .wf-loading h4, .wf-loading a {visibility: hidden;}.wf-active  p, .wf-active h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active a {visibility: visible;}.wf-inactive    p, .wf-inactive h1, .wf-inactive h2, .wf-inactive h3, .wf-inactive h4, wf-inactive a {visibility: visible;}
</style>

    </head>

    <body bgcolor="#000">
      
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQ3JDPK"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      

        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Persistance MongoDB, et indexation ElasticSearch</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/project/">Projects</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="/resume/"><i class="fa fa-user"></i></a></li>
                            
                                <li class="navbar-icon"><a href="http://www.google.com/recaptcha/mailhide/d?k=01IIc-s5LNYiS-CG_gthn4PA==&amp;c=r5Ctx8RMDz422qmYESfk1g=="><i class="fa fa-envelope"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/Geo-Joy"><i class="fa fa-github-alt"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/megeojoy"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/geojoy/"><i class="fa fa-linkedin"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main class="fade-in">

    <div class="item">

    
    
    

    
      

    <h4><a itemprop="url" href="/post---copy/persistance-mongodb-indexation-elasticsearch/">
      <span itemprop="name">Persistance MongoDB, et indexation ElasticSearch</span>
    </a></h4>

    October 19, 2013
    <h5>Utilisation du concept des &#39;rivers&#39; ElasticSearch pour indexer une base MongoDB.</h5>
     <a href="../../../../../tags/elasticsearch"><kbd class="item-tag">elasticsearch</kbd></a>  <a href="../../../../../tags/mongodb"><kbd class="item-tag">mongodb</kbd></a>  <a href="../../../../../tags/river"><kbd class="item-tag">river</kbd></a> 

</div>


    <br> <div class="text-justify">

<div class="w3-panel w3-red w3-card-8 w3-text-white">
  <div class="alert-title">Attention !</div>
  <div class="alert-content">Le concept de &#39;river&#39; a été supprimé d&#39;ElasticSearch, cet article n&#39;est plus à jour.</div>
</div>


<p>Je travaille actuellement sur un projet personnel utilisant <a href="http://www.mongodb.org/">MongoDB</a> comme base de persistance, et j&rsquo;ai eu besoin de mettre en place un dispositif de recherche multi-critères (geo, fuzzy, etc.), mon choix c&rsquo;est tout de suite pencher sur <a href="http://www.elasticsearch.org/">ElasticSearch</a>.</p>

<p>ElasticSearch est un moteur de recherche clusterisable, basé sur Lucene. Il fonctionne sous la forme d&rsquo;un grid d&rsquo;instance qui équilibre les indexes entre les membres d&rsquo;un même cluster.</p>

<p>Il possède beaucoup de plugins, dont quelques uns en particuliers, les plugins &lsquo;river&rsquo; (rivière) ces plugins sont destinés à alimenter le cluster ElasticSearch à partir de sources de données. Il ne s&rsquo;agit pas içi d&rsquo;indexation volontaire et explicite des documents comme on le ferait à partir d&rsquo;un service métier, mais plus d&rsquo;une indexation de la base de données à la source.</p>

<h1 id="installation">Installation</h1>

<p>Vous devez procéder à l&rsquo;installation de MongoDB et d&rsquo;ElasticSearch.</p>

<h2 id="mongodb">MongoDB</h2>

<p>L&rsquo;installation se fait avec votre gestionnaire de paquet habituel :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew install mongodb <span style="color:#776e71"># sous Mac
</span><span style="color:#776e71"></span>$ zypper install mongodb # sous OpenSuSE</code></pre></div>
<p>Pour plus d&rsquo;infos pour l&rsquo;intallation sous RedHat (et compatibles), c&rsquo;est <a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-red-hat-centos-or-fedora-linux/">ici</a>.</p>

<p>Une fois MongoDB installé, il fait configurer l&rsquo;instance MongoDB comme faisant partie d&rsquo;un cluster répliqué (Replicate Set: replSet).</p>

<p>Il faut lancer le serveur MongoDB avec le paramètre <code>--replSet rs0</code>, <code>rs0</code> étant l&rsquo;identifiant du groupe réplication.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongod --port <span style="color:#f99b15">27017</span> --dbpath mongo_data --replSet rs0</code></pre></div>
<p>Vous pouvez aussi modifier le fichier de configuration globale pour activer par défaut le groupe de réplication. Dans le fichier <code>mongodb.conf</code> :</p>

<pre><code>replSet = rs0
</code></pre>

<p>Il faut maintenant <a href="http://docs.mongodb.org/manual/tutorial/deploy-replica-set-for-testing/">déployer une stratégie de réplication sur MongoDB</a>, pour cela connectez vous avec le shell :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongo
&gt; <span style="color:#ef6155">cfg</span> <span style="color:#5bc4bf">=</span> <span style="color:#5bc4bf">{</span> <span style="color:#48b685">&#34;_id&#34;</span> : <span style="color:#48b685">&#34;rs0&#34;</span>, <span style="color:#48b685">&#34;version&#34;</span> : <span style="color:#f99b15">1</span>, <span style="color:#48b685">&#34;members&#34;</span> : <span style="color:#5bc4bf">[</span> <span style="color:#5bc4bf">{</span> <span style="color:#48b685">&#34;_id&#34;</span> : <span style="color:#f99b15">0</span>, <span style="color:#48b685">&#34;host&#34;</span> : <span style="color:#48b685">&#34;localhost:27017&#34;</span> <span style="color:#5bc4bf">}</span> <span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">}</span>
&gt; rs.initiate<span style="color:#5bc4bf">(</span>cfg<span style="color:#5bc4bf">)</span></code></pre></div>
<p>Vous venez de déployer une stratégie de réplication où vous êtes le seul membre. Cette configuration est nécessaire pour permettre la communication entre MongoDB et ElasticSearch au travers du plugin <code>river-mongodb</code>.</p>

<h2 id="elasticsearch">ElasticSearch</h2>

<p>Tout d&rsquo;abord, allez <a href="http://www.elasticsearch.org/download/">télécharger ElasticSearch 0.90.5</a>.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ tar zxvf elasticsearch-0.90.5.tar.gz
....
$ cd elasticsearch-0.90.5
$ bin/elasticsearch -f</code></pre></div>
<p>Démarrez ElasticSearch au moins une fois pour vérifier qu&rsquo;il fonctionne avant modification de la configuration.
Si c&rsquo;est le cas, vous pouvez passer à la suite.</p>

<h3 id="plugin-elasticsearch-river-mongo">Plugin &lsquo;elasticsearch-river-mongo&rsquo;</h3>

<p>[warning]Attention, les versions de MongoDB et d&rsquo;ElasticSearch doivent correspondre.[/warning]</p>

<p>Vous pouvez installer les plugins ElasticSearch de deux façons différentes :</p>

<ul>
<li>En utilisant l&rsquo;outil de gestion des plugins, <code>bin/plugin</code></li>
<li>En téléchargeant les sources, pour générer le package du plugin</li>
</ul>

<h4 id="installation-par-le-gestionnaire">Installation par le gestionnaire :</h4>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ bin/plugin -install richardwilly98/elasticsearch-river-mongodb/&lt;version&gt;</code></pre></div>
<p>Normalement si tout se passe bien, vous devez avoir installé le plugin, essayez de relancer ElasticSearch :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ elasticsearch -f
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:02,102<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>node    <span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">[</span>Dvorak, Sybil<span style="color:#5bc4bf">]</span> version<span style="color:#5bc4bf">[</span><span style="color:#f99b15">0</span>.90.5<span style="color:#5bc4bf">]</span>, pid<span style="color:#5bc4bf">[</span><span style="color:#f99b15">57709</span><span style="color:#5bc4bf">]</span>, build<span style="color:#5bc4bf">[</span>c8714e8/2013-09-17T12:50:20Z<span style="color:#5bc4bf">]</span>
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:02,104<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>node    <span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">[</span>Dvorak, Sybil<span style="color:#5bc4bf">]</span> initializing ...
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:02,317<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>plugins <span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">[</span>Dvorak, Sybil<span style="color:#5bc4bf">]</span> loaded <span style="color:#5bc4bf">[</span>mongodb-river, river-rabbitmq, transport-thrift, mapper-attachments, suggest, river-couchdb<span style="color:#5bc4bf">]</span>, sites <span style="color:#5bc4bf">[</span>mongodb-river<span style="color:#5bc4bf">]</span>
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:04,903<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>node    <span style="color:#5bc4bf">]</span> <span style="color:#5bc4bf">[</span>Dvorak, Sybil<span style="color:#5bc4bf">]</span> initialized</code></pre></div>
<p>Vous devriez voir des logs comme présentées ci-dessus, avec dans la ligne <code>plugins</code>, l&rsquo;affichage du texte <code>mongodb-river</code> indiquant la prise en compte du plugin par le système.</p>

<h4 id="installation-manuelle">Installation manuelle :</h4>

<p>Il faut récupérer les sources sur le dépot <a href="https://github.com/richardwilly98/elasticsearch-river-mongodb">Github</a>, et générer le paquet de distribution :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone https://github.com/richardwilly98/elasticsearch-river-mongodb.git
$ cd elasticsearch-river-mongodb
$ get checkout &lt;version&gt; -b stable
$ mvn clean package # -DskipTests si vous estimez que les tests ne sont pas nécessaires.</code></pre></div>
<p>Le fichier &lsquo;.zip&rsquo; sera généré dans le répertoire <code>target/releases', il suffit d'extraire le contenu dans le répertoire plugins d'ElasticSearch, et de renommer le répertoire en</code>mongodb-river`.</p>

<h4 id="configuration">Configuration</h4>

<p>Le plugin est installé, il faut à présent le configurer. La configuration ElasticSearch se fait en utilisant le protocole REST, sur le plugin concerné par la configuration.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -XPUT <span style="color:#48b685">&#34;localhost:9200/_river/&lt;index&gt;/_meta&#34;</span> -d <span style="color:#48b685">&#39;
</span><span style="color:#48b685">{
</span><span style="color:#48b685">  &#34;type&#34;: &#34;mongodb&#34;,
</span><span style="color:#48b685">  &#34;mongodb&#34;: {
</span><span style="color:#48b685">    &#34;servers&#34;: [
</span><span style="color:#48b685">      { &#34;host&#34;: &#34;127.0.0.1&#34;, &#34;port&#34;: 27017 }
</span><span style="color:#48b685">    ],
</span><span style="color:#48b685">    &#34;options&#34;: { &#34;secondary_read_preference&#34;: true },
</span><span style="color:#48b685">    &#34;db&#34;: &#34;&lt;database&gt;&#34;,
</span><span style="color:#48b685">    &#34;collection&#34;: &#34;&lt;collection&gt;&#34;
</span><span style="color:#48b685">  },
</span><span style="color:#48b685">  &#34;index&#34;: {
</span><span style="color:#48b685">    &#34;name&#34;: &#34;&lt;index&gt;&#34;,
</span><span style="color:#48b685">    &#34;type&#34;: &#34;&lt;type&gt;&#34;
</span><span style="color:#48b685">  }
</span><span style="color:#48b685">}&#39;</span></code></pre></div>
<p>Pour plus d&rsquo;informations sur le <code>secoondary_read_preference</code>, <a href="http://mongodb.github.io/node-mongodb-native/driver-articles/anintroductionto1_1and2_2.html">c&rsquo;est ici</a>.</p>

<ul>
<li>index : le nom de votre index ElasticSearch</li>
<li>database : le nom de votre base de données MongoDB</li>
<li>collection : le nom de la collection MongoDB contenant les documents à indexer</li>
<li>type : le nom du type ElasticSearch de document à indexer</li>
</ul>

<p>A partir du moment où vous allez executer la commande ci-dessus vous devriez vous apparaitre coté ElasticSearch de l&rsquo;activité concernant MongoDB :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:09,119<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>river.mongodb            <span style="color:#5bc4bf">]</span> mongoServersSettings: <span style="color:#5bc4bf">[{</span><span style="color:#ef6155">port</span><span style="color:#5bc4bf">=</span><span style="color:#f99b15">27017</span>, <span style="color:#ef6155">host</span><span style="color:#5bc4bf">=</span><span style="color:#f99b15">127</span>.0.0.1<span style="color:#5bc4bf">}]</span>
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:09,119<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>river.mongodb            <span style="color:#5bc4bf">]</span> Server: <span style="color:#f99b15">127</span>.0.0.1 - <span style="color:#f99b15">27017</span>
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:09,121<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>org.elasticsearch.river.mongodb.MongoDBRiver<span style="color:#5bc4bf">]</span> Using mongodb server<span style="color:#5bc4bf">(</span>s<span style="color:#5bc4bf">)</span>: host <span style="color:#5bc4bf">[</span><span style="color:#f99b15">127</span>.0.0.1<span style="color:#5bc4bf">]</span>, port <span style="color:#5bc4bf">[</span><span style="color:#f99b15">27017</span><span style="color:#5bc4bf">]</span>
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:09,122<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>org.elasticsearch.river.mongodb.MongoDBRiver<span style="color:#5bc4bf">]</span> MongoDB River Plugin version: <span style="color:#5bc4bf">[</span><span style="color:#f99b15">1</span>.7.1<span style="color:#5bc4bf">]</span>
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:21:09,122<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>org.elasticsearch.river.mongodb.MongoDBRiver<span style="color:#5bc4bf">]</span> starting mongodb stream. options: secondaryreadpreference <span style="color:#5bc4bf">[</span>true<span style="color:#5bc4bf">]</span>, drop_collection <span style="color:#5bc4bf">[</span>false<span style="color:#5bc4bf">]</span>, include_collection <span style="color:#5bc4bf">[]</span>, throttlesize <span style="color:#5bc4bf">[</span><span style="color:#f99b15">500</span><span style="color:#5bc4bf">]</span>, gridfs <span style="color:#5bc4bf">[</span>false<span style="color:#5bc4bf">]</span>, filter <span style="color:#5bc4bf">[]</span>, db <span style="color:#5bc4bf">[</span>&lt;database&gt;<span style="color:#5bc4bf">]</span>, collection <span style="color:#5bc4bf">[</span>&lt;collection&gt;<span style="color:#5bc4bf">]</span>, script <span style="color:#5bc4bf">[</span>null<span style="color:#5bc4bf">]</span>, indexing to <span style="color:#5bc4bf">[</span>&lt;index&gt;<span style="color:#5bc4bf">]</span>/<span style="color:#5bc4bf">[</span>&lt;type&gt;<span style="color:#5bc4bf">]</span></code></pre></div>
<h1 id="utilisation">Utilisation</h1>

<p>Vous pouvez commencer à insérer, modifier, supprimer des entrèes dans la base de données MongoDB, les index ElasticSearch seront automatiquements mis à jour.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:37:22,253<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>org.elasticsearch.river.mongodb.Indexer<span style="color:#5bc4bf">]</span> Indexed <span style="color:#f99b15">60</span> documents, <span style="color:#f99b15">60</span> insertions, <span style="color:#f99b15">0</span> updates, <span style="color:#f99b15">0</span> deletions, <span style="color:#f99b15">60</span> documents per second
<span style="color:#5bc4bf">[</span><span style="color:#f99b15">2013</span>-10-19 <span style="color:#f99b15">00</span>:37:22,323<span style="color:#5bc4bf">][</span>INFO <span style="color:#5bc4bf">][</span>org.elasticsearch.river.mongodb.Indexer<span style="color:#5bc4bf">]</span> Indexed <span style="color:#f99b15">0</span> documents, <span style="color:#f99b15">0</span> insertions, <span style="color:#f99b15">40</span> updates, <span style="color:#f99b15">0</span> deletions, <span style="color:#f99b15">0</span> documents per second</code></pre></div>
<p>Par exemple pour une base <code>blog</code>, et une collection <code>articles</code> :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongo
&gt; use blog
&gt; db.articles.save<span style="color:#5bc4bf">({</span>author: <span style="color:#48b685">&#39;zenithar&#39;</span>, content: <span style="color:#48b685">&#39;...&#39;</span>, tags: <span style="color:#5bc4bf">[</span><span style="color:#48b685">&#39;toto&#39;</span>, <span style="color:#48b685">&#39;tutu&#39;</span>, <span style="color:#48b685">&#39;titi&#39;</span><span style="color:#5bc4bf">]})</span></code></pre></div>
<p>Vous pouvez voir dès à présent voir, le document indexé :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://localhost:9200/blog/articles/&lt;object-id&gt;
<span style="color:#5bc4bf">{</span>
   <span style="color:#48b685">&#34;_index&#34;</span>: <span style="color:#48b685">&#34;blog&#34;</span>,
   <span style="color:#48b685">&#34;_type&#34;</span>: <span style="color:#48b685">&#34;article&#34;</span>,
   <span style="color:#48b685">&#34;_id&#34;</span>: <span style="color:#48b685">&#34;&lt;object-id&gt;&#34;</span>,
   <span style="color:#48b685">&#34;_version&#34;</span>: <span style="color:#f99b15">1</span>,
   <span style="color:#48b685">&#34;exists&#34;</span>: true,
   <span style="color:#48b685">&#34;_source&#34;</span>: <span style="color:#5bc4bf">{</span>
      <span style="color:#48b685">&#34;_id&#34;</span>: <span style="color:#48b685">&#34;&lt;object-id&gt;&#34;</span>,
      <span style="color:#48b685">&#34;author&#34;</span>: <span style="color:#48b685">&#34;zenithar&#34;</span>,
      <span style="color:#48b685">&#34;content&#34;</span>: <span style="color:#48b685">&#34;...&#34;</span>,
      <span style="color:#48b685">&#34;tags&#34;</span>: <span style="color:#5bc4bf">[</span>
         <span style="color:#48b685">&#34;toto&#34;</span>,
         <span style="color:#48b685">&#34;tutu&#34;</span>,
         <span style="color:#48b685">&#34;titi&#34;</span>
      <span style="color:#5bc4bf">]</span>
   <span style="color:#5bc4bf">}</span>
<span style="color:#5bc4bf">}</span></code></pre></div>
<h1 id="conclusion">Conclusion</h1>

<p>Ce concept de <code>rivers</code> permet une intégration simple d&rsquo;ElasticSearch au sein d&rsquo;une infrastructure. Qui plus est, il est taillé pour le Cloud, et les problèmes de scalabilité, et clusterabilité associés.</p>

<p>Maintenant pourquoi utiliser ElasticSearch, alors que l&rsquo;on pourrait faire des recherches directements dans MongoDB avec des <code>find</code>, <code>mapreduce</code>, etc ? Et bien la réponse est simple, MongoDB assure la persistance de l&rsquo;information, ElasticSearch est un moteur de recherche, chacun son métier &hellip;</p>
</div>

    
    

    

    

</main>

        <footer>

            <p class="copyright text-muted">Geo Joy &copy; All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a> hosted on <a href="https://github.com/Geo-Joy/geo-joy.github.io">Github</a></p>

        </footer>
        
       <script async="" src="http://geojoy.me/js/main.js"></script>

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KQ3JDPK');</script>


    </body>

</html>

