<!DOCTYPE html>
<html lang="en-us" class="wf-loading">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="preload" href="http://geojoy.me/js/main.js" as="script" />
        <link rel="preload" href="http://geojoy.me/css/main.css" as="style" />

        <title>Archlinux sur un SSD avec LUKS / LVM2 / BTRFS</title>
        <meta name="generator" content="Hugo 0.32.4" />
        
        <link rel="preconnect" href="https://ajax.googleapis.com/" crossorigin>
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
        <meta property="og:title" content="Archlinux sur un SSD avec LUKS / LVM2 / BTRFS" />
<meta property="og:description" content="J&#39;ai reçu mon nouveau portable pro Lenovo T550, voici ma configuration Archlinux." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://geojoy.me/post---copy/archlinux-ssd-luks-lvm-btrfs/" />



<meta property="article:published_time" content="2016-01-24T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-03-01T11:27:29&#43;01:00"/>











    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2016-01-24T00:00:00Z" />
        <meta property="og:article:tag" content="linux" />
        <meta property="og:article:tag" content="devops" />
        <meta property="og:article:tag" content="luks" />
        <meta property="og:article:tag" content="btrfs" />
        <meta property="og:article:tag" content="ssd" />
        
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@megeojoy" />
        <meta name="twitter:creator" content="@megeojoy" />
        <meta name="twitter:title" content="Archlinux sur un SSD avec LUKS / LVM2 / BTRFS" />
        <meta name="twitter:description" content="J&#39;ai reçu mon nouveau portable pro Lenovo T550, voici ma configuration Archlinux." />
        <meta name="twitter:url" content="http://geojoy.me/post---copy/archlinux-ssd-luks-lvm-btrfs/" />
        
    

    
        <meta name="p:domain_verify" content="58lHJFznHgioHOIv2NvLfobc8XEUUZSKm016uFFO4vE"/>
    

    
    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Geo Joy",
      "url": "http://geojoy.me",
      "sameAs": [
        "https://twitter.com/megeojoy",
        "https://www.linkedin.com/in/geojoy/",
        "https://github.com/Geo-Joy",
      ],
      "image": {
        "@type": "ImageObject",
        "url": "https://geojoy.me/images/avatar.jpg",
        "height": 80,
        "width": 80
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "@id": "http://geojoy.me",
      "name": "Geo&#39;z Blog",
      "url": "http://geojoy.me",
      "logo": {
        "@type": "ImageObject",
        "url": "https://geojoy.me/images/avatar.jpg",
        "height": 80,
        "width": 80
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "url": "http://geojoy.me",
      "name": "Geo&#39;z Blog",
      "author": {
        "@type": "Person",
        "name": "Geo Joy"
      },
      "description": ""
    }
    </script>

      
      <script type="application/ld+json">
      {
          "@context": "http://schema.org",
          "@type": "BlogPosting",
          "headline": "Archlinux sur un SSD avec LUKS / LVM2 / BTRFS",
          "description": "J&#39;ai reçu mon nouveau portable pro Lenovo T550, voici ma configuration Archlinux.",
          "author": {
              "@type": "Person",
              "name": "Geo Joy"
          },
          "publisher": {
              "@type": "Organization",
              "name": "Geo&#39;z Blog",
              "logo": "https://geojoy.me/images/avatar.jpg"
          },
          
          "image": {
            "@type": "ImageObject",
            "url": "https://geojoy.me/images/avatar.jpg",
            "height": 80,
            "width": 80
          },
          "datePublished": "2016-01-24",
          "dateModified": "2017-03-01",
          "wordCount": 1935
          ,
          "keywords": ["linux","devops","luks","btrfs","ssd"] 
      }
    </script>
  

    <style>
    body {
        margin: 0
    }

    main,
    nav {
        display: block
    }

    a {
        background-color: transparent
    }

    h1 {
        margin: .67em 0;
        font-size: 2em
    }

    img {
        border: 0
    }

    code,
    kbd {
        font-family: monospace, monospace;
        font-size: 1em
    }

    button {
        margin: 0;
        font: inherit;
        color: inherit
    }

    button {
        overflow: visible
    }

    button {
        text-transform: none
    }

    button {
        -webkit-appearance: button
    }

    button::-moz-focus-inner {
        padding: 0;
        border: 0
    }

    * {
        -webkit-box-sizing: border-box;
        box-sizing: border-box
    }

    :after,
    :before {
        -webkit-box-sizing: border-box;
        box-sizing: border-box
    }

    html {
        font-size: 10px
    }

    body {
        font-family: "Raleway", Helvetica, Arial, sans-serif;
        font-size: 14px;
        line-height: 1.42857143;
        color: #333;
        background-color: #000
    }

    button {
        font-family: inherit;
        font-size: inherit;
        line-height: inherit
    }

    a {
        color: #337ab7;
        text-decoration: none
    }

    img {
        vertical-align: middle
    }

    h1,
    h4,
    h5 {
        font-family: inherit;
        font-weight: 500;
        line-height: 1.1;
        color: inherit
    }

    h1 {
        margin-top: 20px;
        margin-bottom: 10px
    }

    h4,
    h5 {
        margin-top: 10px;
        margin-bottom: 10px
    }

    h1 {
        font-size: 36px
    }

    h4 {
        font-size: 18px
    }

    h5 {
        font-size: 14px
    }

    p {
        margin: 0 0 10px
    }

    .text-justify {
        text-align: justify
    }

    ul {
        margin-top: 0;
        margin-bottom: 10px
    }

    blockquote {
        padding: 10px 20px;
        margin: 0 0 20px;
        font-size: 17.5px;
        border-left: 5px solid #000
    }

    blockquote p:last-child {
        margin-bottom: 0
    }

    code,
    kbd {
        font-family: Menlo, Monaco, Consolas, "Courier New", monospace
    }

    code {
        padding: 2px 4px;
        font-size: 90%;
        color: #c7254e;
        background-color: #000;
        border-radius: 4px
    }

    kbd {
        padding: 2px 4px;
        font-size: 90%;
        color: #000;
        background-color: #333;
        border-radius: 3px;
        -webkit-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .25);
        box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .25)
    }

    .container {
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto;
        margin-left: auto
    }

    @media (min-width:768px) {
        .container {
            width: 750px
        }
    }

    @media (min-width:992px) {
        .container {
            width: 970px
        }
    }

    @media (min-width:1200px) {
        .container {
            width: 1170px
        }
    }

    .collapse {
        display: none
    }

    .nav {
        padding-left: 0;
        margin-bottom: 0;
        list-style: none
    }

    .nav>li {
        position: relative;
        display: block
    }

    .nav>li>a {
        position: relative;
        display: block;
        padding: 10px 15px
    }

    .navbar {
        position: relative;
        min-height: 50px;
        margin-bottom: 20px;
        border: 1px solid transparent
    }

    @media (min-width:768px) {
        .navbar {
            border-radius: 4px
        }
    }

    @media (min-width:768px) {
        .navbar-header {
            float: left
        }
    }

    .navbar-collapse {
        padding-right: 15px;
        padding-left: 15px;
        overflow-x: visible;
        -webkit-overflow-scrolling: touch;
        border-top: 1px solid transparent;
        -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, .1);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, .1)
    }

    @media (min-width:768px) {
        .navbar-collapse {
            width: auto;
            border-top: 0;
            -webkit-box-shadow: none;
            box-shadow: none
        }
        .navbar-collapse.collapse {
            display: block !important;
            height: auto !important;
            padding-bottom: 0;
            overflow: visible !important
        }
        .navbar-fixed-top .navbar-collapse {
            padding-right: 0;
            padding-left: 0
        }
    }

    .navbar-fixed-top .navbar-collapse {
        max-height: 340px
    }

    @media (max-device-width:480px) and (orientation:landscape) {
        .navbar-fixed-top .navbar-collapse {
            max-height: 200px
        }
    }

    .container>.navbar-collapse,
    .container>.navbar-header {
        margin-right: -15px;
        margin-left: -15px
    }

    @media (min-width:768px) {
        .container>.navbar-collapse,
        .container>.navbar-header {
            margin-right: 0;
            margin-left: 0
        }
    }

    .navbar-fixed-top {
        position: fixed;
        right: 0;
        left: 0;
        z-index: 1030
    }

    @media (min-width:768px) {
        .navbar-fixed-top {
            border-radius: 0
        }
    }

    .navbar-fixed-top {
        top: 0;
        border-width: 0 0 1px
    }

    .navbar-brand {
        float: left;
        height: 50px;
        padding: 15px 15px;
        font-size: 18px;
        line-height: 20px
    }

    @media (min-width:768px) {
        .navbar>.container .navbar-brand {
            margin-left: -15px
        }
    }

    .navbar-toggle {
        position: relative;
        float: right;
        padding: 9px 10px;
        margin-top: 8px;
        margin-right: 15px;
        margin-bottom: 8px;
        background-color: transparent;
        background-image: none;
        border: 1px solid transparent;
        border-radius: 4px
    }

    .navbar-toggle .icon-bar {
        display: block;
        width: 22px;
        height: 2px;
        border-radius: 1px
    }

    .navbar-toggle .icon-bar+.icon-bar {
        margin-top: 4px
    }

    @media (min-width:768px) {
        .navbar-toggle {
            display: none
        }
    }

    .navbar-nav {
        margin: 7.5px -15px
    }

    .navbar-nav>li>a {
        padding-top: 10px;
        padding-bottom: 10px;
        line-height: 20px
    }

    @media (min-width:768px) {
        .navbar-nav {
            float: left;
            margin: 0
        }
        .navbar-nav>li {
            float: left
        }
        .navbar-nav>li>a {
            padding-top: 15px;
            padding-bottom: 15px
        }
    }

    @media (min-width:768px) {
        .navbar-right {
            float: right !important;
            margin-right: -15px
        }
    }

    .navbar-default {
        background-color: #000;
        border-color: #000
    }

    .navbar-default .navbar-brand {
        color: #777
    }

    .navbar-default .navbar-nav>li>a {
        color: #777
    }

    .navbar-default .navbar-toggle {
        border-color: #ddd
    }

    .navbar-default .navbar-toggle .icon-bar {
        background-color: #888
    }

    .navbar-default .navbar-collapse {
        border-color: #e7e7e7
    }

    .container:after,
    .container:before,
    .nav:after,
    .nav:before,
    .navbar-collapse:after,
    .navbar-collapse:before,
    .navbar-header:after,
    .navbar-header:before,
    .navbar:after,
    .navbar:before {
        display: table;
        content: " "
    }

    .container:after,
    .nav:after,
    .navbar-collapse:after,
    .navbar-header:after,
    .navbar:after {
        clear: both
    }

    @-ms-viewport {
        width: device-width
    }

    .visible-xs {
        display: none !important
    }

    @media (max-width:767px) {
        .visible-xs {
            display: block !important
        }
    }

    html {
        height: 100%
    }

    body {
        height: 100%;
        padding-top: 55px;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        text-align: center;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        font-size: 16px !important
    }

    main {
        margin: auto;
        padding: 25px;
        max-width: 750px
    }

    a:link,
    a:visited {
        color: green
    }

    .item {
        padding: 10px 0
    }

    .item-tag {
        background-color: green
    }

    .navbar-icon {
        font-size: 125%;
        display: inline-block !important
    }

    .navbar.navbar-default {
        border-top: 5px solid green
    }

    img {
        max-width: 100%
    }

    .fade-in {
        opacity: 0
    }

    .wf-loading p,
    .wf-loading h1,
    .wf-loading h2,
    .wf-loading h3,
    .wf-loading h4,
    .wf-loading a {
        visibility: hidden;
    }

    .wf-active p,
    .wf-active h1,
    .wf-active h2,
    .wf-active h3,
    .wf-active h4,
    .wf-active a {
        visibility: visible;
    }

    .wf-inactive p,
    .wf-inactive h1,
    .wf-inactive h2,
    .wf-inactive h3,
    .wf-inactive h4,
    wf-inactive a {
        visibility: visible;
    }
</style>
    </head>

    <body bgcolor="#000">
      
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQ3JDPK"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      

        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Archlinux sur un SSD avec LUKS / LVM2 / BTRFS</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/project/">Projects</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="/resume/"><i class="fa fa-user"></i></a></li>
                            
                                <li class="navbar-icon"><a href="http://www.google.com/recaptcha/mailhide/d?k=01IIc-s5LNYiS-CG_gthn4PA==&amp;c=r5Ctx8RMDz422qmYESfk1g=="><i class="fa fa-envelope"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/Geo-Joy"><i class="fa fa-github-alt"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/megeojoy"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/geojoy/"><i class="fa fa-linkedin"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main class="fade-in">

    <div class="item">

    
    
    

    
      

    <h4><a itemprop="url" href="/post---copy/archlinux-ssd-luks-lvm-btrfs/">
      <span itemprop="name">Archlinux sur un SSD avec LUKS / LVM2 / BTRFS</span>
    </a></h4>

    January 24, 2016
    <h5>J&#39;ai reçu mon nouveau portable pro Lenovo T550, voici ma configuration Archlinux.</h5>
     <a href="../../../../../tags/linux"><kbd class="item-tag">linux</kbd></a>  <a href="../../../../../tags/devops"><kbd class="item-tag">devops</kbd></a>  <a href="../../../../../tags/luks"><kbd class="item-tag">luks</kbd></a>  <a href="../../../../../tags/btrfs"><kbd class="item-tag">btrfs</kbd></a>  <a href="../../../../../tags/ssd"><kbd class="item-tag">ssd</kbd></a> 

</div>


    <br> <div class="text-justify">

<p>J&rsquo;utilise Archlinux depuis plus de 3 ans maintenant comme système d&rsquo;exploitation
principal au boulot.
Le but de cet article est de créer une configuration qui fonctionne ! Je vais
essayer d&rsquo;expliquer toutes les étapes et les configurations.</p>

<h1 id="préparation-de-l-image">Préparation de l&rsquo;image</h1>

<p>L&rsquo;image d&rsquo;installation est une image ISO, qui peut être simplement gravée sur un
CD, ou sur une clé USB.</p>

<p>La procédure est documentée <a href="https://wiki.archlinux.fr/Cr%C3%A9er_une_clef_USB_avec_l%27ISO_Arch_Linux">ici</a>.</p>

<h1 id="démarrage">Démarrage</h1>

<p>Vous venez de créer le média d&rsquo;installation. Vous pouvez à présent démarrer la
procédure. Après quelques secondes, vous devez attérir sur une console :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ loadkeys fr             <span style="color:#776e71"># active le clavier français
</span><span style="color:#776e71"></span>$ setfont Lat2-Terminus16 # change la police d<span style="color:#ef6155">&#39;</span>affichage pour la console</code></pre></div>
<h2 id="connectivité-réseau">Connectivité réseau</h2>

<p>Il est important de connecter votre environnement d&rsquo;installation à internet,
la récupération des paquets d&rsquo;installation se fait par défaut à l&rsquo;aide de dépot
publiques.</p>

<h4 id="par-câble">Par câble</h4>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ dhcpcd enp0s25  # Configuration DHCP</code></pre></div>
<h4 id="par-wifi">Par Wifi</h4>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ wifi-menu
$ netctl start &lt;profile&gt;</code></pre></div>
<p>Si votre réseau est masqué</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ iwconfig wlp3s0 essid <span style="color:#48b685">&#34;&lt;votre essid&gt;&#34;</span>
$ wifi-menu wlp3s0
<span style="color:#776e71"># Sélectionnez le réseau avec le nom de votre réseau.
</span><span style="color:#776e71"></span>$ netctl start &lt;profile&gt;</code></pre></div>
<p>Pensez à vérifier la connexion :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ping -c3 www.google.com</code></pre></div>
<h2 id="tout-effacer">Tout effacer</h2>

<p>Afin de mettre en place un volume chiffré, il faut commencer par effacer le
disque en entier.</p>

<p>Petite astuce pour aller plus vite, la lecture de <code>/dev/urandom</code> est trop lente
ce qui aurait pour effet de ralentir la procédure, donc pour accélerer les choses
je vous propose d&rsquo;utiliser LUKS.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cryptsetup open --type plain /dev/sda ssd
<span style="color:#776e71"># La clé qui va vous être demandée ne porte que peu d&#39;intéret cela va juste servir
</span><span style="color:#776e71"># au chiffrement des données
</span><span style="color:#776e71"></span>$ ddrescue -f /dev/zero /dev/mapper/ssd</code></pre></div>
<blockquote>
<p>Cette opération prends 10-12 minutes sur un SSD de 256Go.</p>
</blockquote>

<h2 id="préparation-du-disque">Préparation du disque</h2>

<p>J&rsquo;ai choisi d&rsquo;utiliser le mode de démarrage EFI, pour cela il faut créer une
partition sur le disque nommée <code>ESP</code>, cette partition contient les informations
de démarrage.</p>

<table>
<thead>
<tr>
<th>Type</th>
<th>Nom</th>
<th>Taille</th>
<th>MountPoint</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>EFI [ef00]</td>
<td>BOOT</td>
<td>500Mo</td>
<td>/boot/efi</td>
<td>Contiendra le noyau et les paramètres du bootloader</td>
</tr>

<tr>
<td>Linux [8300]</td>
<td>ssd</td>
<td>+100%Free</td>
<td></td>
<td>Volume chiffré avec LUKS</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ gdisk /dev/sda
  n               <span style="color:#776e71"># Créer une partition
</span><span style="color:#776e71"></span>  &lt;enter&gt;         <span style="color:#776e71"># ID de la partition [1]
</span><span style="color:#776e71"></span>  &lt;enter&gt;         <span style="color:#776e71"># Secteur de début [2048]
</span><span style="color:#776e71"></span>  +500M           
  ef00            <span style="color:#776e71"># Type de partition EFI Boot [ef00]
</span><span style="color:#776e71"></span>  n               <span style="color:#776e71"># Créer une partition
</span><span style="color:#776e71"></span>  &lt;enter&gt;         <span style="color:#776e71"># Id de la partition [2]
</span><span style="color:#776e71"></span>  &lt;enter&gt;         <span style="color:#776e71"># Secteur de début, calculé à partir de la partition précédente
</span><span style="color:#776e71"></span>  &lt;enter&gt;         <span style="color:#776e71"># Secteur de fin, fin du disque par défaut
</span><span style="color:#776e71"></span>  &lt;enter&gt;         <span style="color:#776e71"># Type de partition Linux Filesystem [8300] par défaut
</span><span style="color:#776e71"></span>  w               <span style="color:#776e71"># Ecrire la table des partitions
</span><span style="color:#776e71"></span>$ ls /dev/sda*
/dev/sda1 /dev/sda2</code></pre></div>
<blockquote>
<p>Si vous avez un message d&rsquo;erreur concernant la table des partitions et le noyau
  je vous conseille de redémarrer la machine.</p>
</blockquote>

<p>Nous venons de créer 2 partitions sur le disque <code>/dev/sda</code>.
Il faut formatter la partition <code>ESP</code> en FAT32, pour être compatible avec le
&ldquo;standard&rdquo; UEFI.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ mkfs.vfat -F32 -n BOOT /dev/sda1</code></pre></div>
<p>La seconde partition contiendra le volume chiffré <code>LUKS</code>.</p>

<h3 id="chiffrement">Chiffrement</h3>

<p>Le chiffrement du disque est géré par LUKS, qui met en place un proxy à
l&rsquo;écriture et à la lecture au travers d&rsquo;un périphérique &ldquo;mappé&rdquo; via device-mapper.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cryptsetup benchmark
# choisissez l<span style="color:#ef6155">&#39;</span>algorithme le plus rapide sur votre machine.</code></pre></div>
<blockquote>
<p>Attention, le plus rapide ne signifie pas forcément plus sécurisé.</p>
</blockquote>

<p>Aujourd&rsquo;hui les processeurs modernes supportent le chiffrement AES en natif <code>aesni</code>.
Vouc pouvez vérifier le support des instructions par la consultation de extensions
CPU disponibles :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ fgrep aes /pro/cpuinfo
# S<span style="color:#ef6155">&#39;</span>il y a une sortie votre processeur supporte le chiffrement accéléré.</code></pre></div>
<p>Principalement, c&rsquo;est la taille de la clé qui va déterminer la vitesse de
chiffrement / déchiffrement.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cryptsetup --type aes-xts-plain64 --hash sha512 --key-size <span style="color:#f99b15">256</span> --verify-passphrase luksFormat /dev/sda2</code></pre></div>
<table>
<thead>
<tr>
<th>Paramètre</th>
<th>Valeur</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>type</td>
<td>aes-xts-plain64</td>
<td>Chiffrement AES en mode XTS.</td>
</tr>

<tr>
<td>hash</td>
<td>sha512</td>
<td>Algorithme utilisé pour la dérivation de clé PBKDF2 à partir de la passphrase.</td>
</tr>

<tr>
<td>key-size</td>
<td>256</td>
<td>Taille de la clé AES</td>
</tr>

<tr>
<td>verify-passphrase</td>
<td></td>
<td>Active la vérification de passphrase, vous devez la saisir 2 fois.</td>
</tr>
</tbody>
</table>

<p>On voit souvent sur d&rsquo;autres tutoriaux :</p>

<ul>
<li><code>aes-xts-plain</code> : c&rsquo;est le même algorithme que la version plain64, mais
celui-ci était limité à des volumes &lt; 2To;</li>
<li><code>aes-cbc-essiv</code> : c&rsquo;est un algorithme AES en mode Chain Block, utilisé
historiquement, le plus gros problème du <code>CBC</code> c&rsquo;est le
stockage de l&rsquo;<code>IV</code>.</li>
</ul>

<blockquote>
<p>Le choix de la taille de clé est de votre responsabilité, plus de sécurité =&gt;
  moins rapide, plus rapide =&gt; moins de sécurité.</p>
</blockquote>

<p>Il faut maintenant <code>ouvrir</code> le volume chiffré.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cryptsetup luksOpen /dev/sda2 ssd</code></pre></div>
<p>Le disque &ldquo;virtuel&rdquo; est accessible depuis <code>/dev/mapper/ssd</code>.
Ce disque correspond au périphérique chiffré.</p>

<h3 id="préparation-des-systèmes-de-fichiers">Préparation des systèmes de fichiers</h3>

<table>
<thead>
<tr>
<th>Type</th>
<th>Nom</th>
<th>Taille</th>
<th>MountPoint</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>swap</td>
<td>swap</td>
<td>16Go</td>
<td>-</td>
<td>Utilisé comme espace de swap, et pour l&rsquo;hibernation (&gt;= RAM)</td>
</tr>

<tr>
<td>btrfs</td>
<td>arch</td>
<td>Le reste</td>
<td></td>
<td>Contiendra les volumes BTRFS</td>
</tr>
</tbody>
</table>

<p>La partition chiffrée est opérationnelle, il reste à préparer le volume LVM.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pvcreate /dev/mapper/ssd
<span style="color:#776e71"># Initialise un conteneur physique LVM
</span><span style="color:#776e71"></span>$ vgcreate vg /dev/mapper/ssd
<span style="color:#776e71"># Initialise un volume group dans le conteneur
</span><span style="color:#776e71"></span>$ lvcreate -L &lt;N&gt;G vg -n swap
<span style="color:#776e71"># Initialise une partition de N Go nommée &#39;swap&#39; dans le volume group &#39;vg&#39;
</span><span style="color:#776e71"></span>$ lvcreate -l +100%FREE vg -n arch
# Initialise une partition nommée <span style="color:#48b685">&#39;arch&#39;</span> dans le volume group <span style="color:#48b685">&#39;vg&#39;</span></code></pre></div>
<p>Les volumes LVM sont créés, vous pouvez procéder au formattage.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ mkswap -L SWAP /dev/mapper/vg-swap
<span style="color:#776e71"># Formatte la partition de swap, et ajoute le label &#39;SWAP&#39;
</span><span style="color:#776e71"></span>$ mkfs.btrfs -KL ARCH /dev/mapper/vg-arch
# Formatte la partition root, et ajoute le label <span style="color:#48b685">&#39;ARCH&#39;</span></code></pre></div>
<h3 id="préparation-des-points-de-montage">Préparation des points de montage</h3>

<p><a href="https://fr.wikipedia.org/wiki/Btrfs">BTRFS</a> est particulier puisqu&rsquo;il possède les fonctionnalités de LVM2
(gestion des volumes), et c&rsquo;est aussi un système de fichiers. Il est vu comme
le successeur de Ext4.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ mount -o defaults,noatime,ssd,discard,compress<span style="color:#5bc4bf">=</span>lzo /dev/mapper/vg-arch /mnt
$ cd /mnt
$ btrfs subvolume create __active
$ btrfs subvolume create __active/rootvol
$ btrfs subvolume create __active/home
$ btrfs subvolume create __active/var
$ btrfs subvolume create snapshots
$ cd
$ umount /mnt</code></pre></div>
<p>J&rsquo;ai choisi d&rsquo;activer la compression à la volée <code>lzo</code> sur mon disque SSD.
Cette option n&rsquo;est pas activée par défaut, et peut avoir de lourdes conséquences
en consommation CPU. Le principe est simple les données sont compressées puis
chiffrées avant d&rsquo;être écrites sur le disque.</p>

<blockquote>
<p>Si vous n&rsquo;avez pas de SSD, il suffit d&rsquo;enlever les options <code>ssd</code> et <code>discard</code></p>
</blockquote>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ mount -o defaults,noatime,ssd,discard,compress<span style="color:#5bc4bf">=</span>lzo,subvol<span style="color:#5bc4bf">=</span>__active/rootvol /dev/mapper/vg-arch /mnt
$ mkdir -p /mnt/<span style="color:#5bc4bf">{</span>home,boot/efi,var<span style="color:#5bc4bf">}</span>
$ mount -o defaults,noatime,ssd,discard,compress<span style="color:#5bc4bf">=</span>lzo,subvol<span style="color:#5bc4bf">=</span>__active/home /dev/mapper/vg-arch /mnt/home
$ mount -o defaults,noatime,ssd,discard,compress<span style="color:#5bc4bf">=</span>lzo,subvol<span style="color:#5bc4bf">=</span>__active/var /dev/mapper/vg-arch /mnt/var
$ mount /dev/sda1 /mnt/boot/efi
$ swapon /dev/mapper/vg-swap</code></pre></div>
<h2 id="installation-du-système-minimal">Installation du système minimal</h2>

<p>Vous pouvez à présent démarrer l&rsquo;installation du système minimal.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pacstrap /mnt base base-devel btrfs-progs <span style="color:#f99b15">\
</span><span style="color:#f99b15"></span>                net-tools wireless_tools dialog wpa_supplicant <span style="color:#f99b15">\
</span><span style="color:#f99b15"></span>                efibootmgr syslinux <span style="color:#f99b15">\
</span><span style="color:#f99b15"></span>                vim zsh</code></pre></div>
<table>
<thead>
<tr>
<th>Paquet</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=base">base</a></td>
<td>Archlinux base system</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=base-devel">base-devel</a></td>
<td>Environnement de compilation et de développement (gcc, make, etc.)</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=btrfs-progs">btrfs-progs</a></td>
<td>Outils de gestion, réparation de volume BTRFS</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=net-tools">net-tools</a></td>
<td>Outils de gestion réseau (ifconfig)</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=wireless_tools">wireless_tools</a></td>
<td>Outils de gestion réseau sans-fil (iwconfig)</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=dialog">dialog</a></td>
<td>Dépendances de wifi-menu</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=wpa_supplicant">wpa_supplicant</a></td>
<td>Agent d&rsquo;authentification Wifi (WPA)</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=efibootmgr">efibootmgr</a></td>
<td>Outil de gestion des entrées EFI</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=syslinux">syslinux</a></td>
<td>Bootloader (j&rsquo;aime pas Grub avec EFI)</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=vim">vim</a></td>
<td>Editeur de texte</td>
</tr>

<tr>
<td><a href="http://www.archlinux.org/packages/?arch=any&amp;arch=i686&amp;arch=x86_64&amp;q=zsh">zsh</a></td>
<td>Shell alternatif</td>
</tr>
</tbody>
</table>

<p>Les partitions sont montées comme sur votre système final. Vous pouvez utiliser
<code>genfstab</code> qui va générer votre plan de montage.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab</code></pre></div>
<p>Le fichier doit être modifié, seulement pour ajouter le support SSD.</p>

<pre><code>/dev/mapper/vg-swap swap  swap  defaults,discard 0 0
</code></pre>

<h2 id="configuration-initiale">Configuration initiale</h2>

<blockquote>
<p>Attention ne soyez pas trop pressés de rebooter sur votre nouvel environement,
  au risque de vous retrouver bloqué devant la porte !</p>
</blockquote>

<p>Vous devez rentrer dans l&rsquo;environnement fraîchement installé</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ arch-chroot /mnt /bin/bash</code></pre></div>
<p>A partir de ce point vous êtes dans votre nouveau système comme si vous veniez
de redémarrer.</p>

<p>Il faut configurer le clavier :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ echo <span style="color:#48b685">&#34;KEYMAP=\&#34;fr\&#34;&#34;</span> &gt;&gt; /etc/vconsole.conf</code></pre></div>
<p>Les languages supportés par votre système :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ vim /etc/locale.gen
<span style="color:#776e71"># Décommenter en_GB.UTF-8, en_US.UTF-8, fr_FR.UTF-8
</span><span style="color:#776e71"></span>$ locale-gen
<span style="color:#776e71"># Génère les locales
</span><span style="color:#776e71"></span>$ echo <span style="color:#48b685">&#34;LANG=\&#34;fr_FR.UTF-8\&#34;&#34;</span> &gt;&gt; /etc/locale.conf</code></pre></div>
<blockquote>
<p>Définissez <code>LANG</code> à <code>en_US.UTF-8</code> si vous souhaitez un système en anglais.</p>
</blockquote>

<p>Définir la timezone :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ln -s /usr/share/zoneinfo/Europe/Paris /etc/localtime</code></pre></div>
<p>Changer le nom de la machine :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ echo <span style="color:#48b685">&#34;monarch&#34;</span> &gt; /etc/hostname</code></pre></div>
<p>Changer le mot de passe <code>root</code> :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ passwd</code></pre></div>
<p>Créer un utilisateur quotidien :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ useradd -g users -G wheel -m zenithar
$ passwd zenithar</code></pre></div>
<blockquote>
<p>C&rsquo;est pas fini !</p>
</blockquote>

<h2 id="noyau-initial">Noyau initial</h2>

<p>Il faut préparer votre noyau, alors pas de recompilation mais simplement de la
configuration.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ vim /etc/mkinitcpio.conf
<span style="color:#ef6155">MODULES</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;i915&#34;</span>
...
<span style="color:#ef6155">BINARIES</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;/usr/bin/btrfsck&#34;</span>
...
<span style="color:#ef6155">HOOKS</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#34;... keyboard keymap encrypt lvm2 resume ... filesystems ...&#34;</span>
...
$ mkinitcpio -p linux</code></pre></div>
<blockquote>
<p>L&rsquo;ordre des modules est important !</p>
</blockquote>

<p>Pour plus d&rsquo;informations, le descriptif des <code>hooks</code> est disponible <a href="https://wiki.archlinux.fr/Mkinitcpio#Hooks">ici</a>.</p>

<p>Le module <code>i915</code> est propre à ma <a href="https://wiki.archlinux.org/index.php/Lenovo_ThinkPad_T550">configuration</a>, c&rsquo;est le module de gestion de la carte graphique.</p>

<h2 id="chargeur-de-démarrage">Chargeur de démarrage</h2>

<p>J&rsquo;ai choisi d&rsquo;utiliser Syslinux en mode EFI. Alors pourquoi pas Grub, et bien
j&rsquo;aime pas l&rsquo;idée de donner accès à Grub sur la partition chiffrée.
Je trouve que le mode de fonctionnement avec Grub et LUKS n&rsquo;est pas bon, mais
ce n&rsquo;est que mon avis, beaucoup trop intrusif.</p>

<blockquote>
<p>L&rsquo;utilisateur devrait être le seul à pouvoir ouvrir la partition chiffrée,
  même si LUKS permet d&rsquo;ajouter des clés.</p>
</blockquote>

<p>Je trouve de ce fait, que le principe de syslinux est plus dans la &ldquo;normalité&rdquo; :
il se charge de faire démarrer le noyau et c&rsquo;est tout. Bon je pourrais rajouter
des trolls sur les dernières vulnérabilités Grub &hellip; Mot de passe inutile &hellip; <a href="http://hmarco.org/bugs/CVE-2015-8370-Grub2-authentication-bypass.html">CVE-2015-8370</a></p>

<p>Vous devez copier le chargeur de démarrage sur la partition <code>ESP</code> :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ mkdir -p /boot/efi/EFI/syslinux
$ cp -r /usr/lib/syslinux/efi64/* /boot/efi/EFI/syslinux/</code></pre></div>
<p>Ensuite ajouter le lien vers syslinux dans la table UEFI :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ efibootmgr -c -d /dev/sda -p <span style="color:#f99b15">1</span> -l /EFI/syslinux/syslinux.efi -L <span style="color:#48b685">&#34;Syslinux&#34;</span></code></pre></div>
<blockquote>
<p>Le chemin /EFI est absolu au boot, mais pour vous c&rsquo;est /boot/efi/EFI</p>
</blockquote>

<p>Vous devez éditer le fichier <code>syslinux.cfg</code> :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ vim /boot/efi/EFI/syslinux/syslinux.cfg
UI menu.c32
PROMPT <span style="color:#f99b15">0</span>

MENU TITLE Boot Menu
TIMEOUT <span style="color:#f99b15">50</span>
DEFAULT arch

LABEL arch
        MENU LABEL Arch Linux
        LINUX ../vmlinuz-linux
        APPEND <span style="color:#ef6155">root</span><span style="color:#5bc4bf">=</span>/dev/mapper/vg-arch <span style="color:#ef6155">rootflags</span><span style="color:#5bc4bf">=</span><span style="color:#ef6155">subvol</span><span style="color:#5bc4bf">=</span>__active/rootvol <span style="color:#ef6155">cryptdevice</span><span style="color:#5bc4bf">=</span>/dev/sda2:vg:allow-discards <span style="color:#ef6155">resume</span><span style="color:#5bc4bf">=</span>/dev/mapper/vg-swap rw
        INITRD ../initramfs-linux.img

LABEL archfallback
        MENU LABEL Arch Linux Fallback
        LINUX ../vmlinuz-linux
        APPEND <span style="color:#ef6155">root</span><span style="color:#5bc4bf">=</span>/dev/mapper/vg-arch <span style="color:#ef6155">rootflags</span><span style="color:#5bc4bf">=</span><span style="color:#ef6155">subvol</span><span style="color:#5bc4bf">=</span>__active/rootvol <span style="color:#ef6155">cryptdevice</span><span style="color:#5bc4bf">=</span>/dev/sda2:vg:allow-discards <span style="color:#ef6155">resume</span><span style="color:#5bc4bf">=</span>/dev/mapper/vg-swap rw
        INITRD ../initramfs-linux-fallback.img</code></pre></div>
<p>Le fichier est simple, plus simple que celui de Grub.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#ef6155">root</span><span style="color:#5bc4bf">=</span>/dev/mapper/vg-arch <span style="color:#ef6155">rootflags</span><span style="color:#5bc4bf">=</span><span style="color:#ef6155">subvol</span><span style="color:#5bc4bf">=</span>__active/rootvol <span style="color:#ef6155">cryptdevice</span><span style="color:#5bc4bf">=</span>/dev/sda2:vg:allow-discards <span style="color:#ef6155">resume</span><span style="color:#5bc4bf">=</span>/dev/mapper/vg-swap rw</code></pre></div>
<p>Cette ligne définit les arguments pour le noyau :</p>

<ul>
<li><code>root</code>: définit le chemin de la racine du système; le <code>/</code> est sur <code>/dev/mapper/vg-arch</code> ;</li>
<li><code>rootflags</code>: définit les paramètres de montage liés à BTRFS de la partition définit par <code>root</code>, ici le volume <code>__active/rootvol</code> ;</li>
<li><code>cryptdevice</code>: définit la partition <code>/dev/sda2</code>, le nom du volume group <code>vg</code>, ainsi que les options liées au SSD ;</li>
<li><code>resume</code>: définit la partion utilisée pour l&rsquo;hibernation ;</li>
</ul>

<blockquote>
<p>Pas besoin d&rsquo;installer le chargeur, il a déjà été lié grâce à <code>efibootmgr</code>.</p>
</blockquote>

<p>Il faut copier le noyau, et les images depuis <code>/boot</code> vers <code>/boot/efi/EFI</code> :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cp /boot/vmlinuz-linux /boot/efi/EFI
$ cp /boot/*.img /boot/efi/EFI</code></pre></div>
<h1 id="fin-d-installation">Fin d&rsquo;installation</h1>

<p>Il suffit de tout préparer pour le redémarrage :</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ exit
$ cd
$ umount /mnt/<span style="color:#5bc4bf">{</span>home,var,boot/efi<span style="color:#5bc4bf">}</span> <span style="color:#776e71"># Démontage des volumes BTRFS / ESP
</span><span style="color:#776e71"></span>$ umount /mnt                     <span style="color:#776e71"># Démontage du root
</span><span style="color:#776e71"></span>$ swapoff /dev/mapper/vg-swap     <span style="color:#776e71"># Démontage du swap
</span><span style="color:#776e71"></span>$ cryptsetup luksClose ssd        <span style="color:#776e71"># Démontage du volume LUKS
</span><span style="color:#776e71"></span>$ reboot                          # Let<span style="color:#ef6155">&#39;</span>s go !</code></pre></div>
<p>Voilà, normalement, tout est bon pour l&rsquo;installation du système de base.
Si ce n&rsquo;est pas le cas, vous devez démarrer sur la clé USB / CD qui vous avez
utilisé pour l&rsquo;installation.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ loadkeys fr
$ cryptsetup luksOpen /dev/sda2 ssd
$ mount -o defaults,noatime,ssd,discard,compress<span style="color:#5bc4bf">=</span>lzo,subvol<span style="color:#5bc4bf">=</span>__active/rootvol /dev/mapper/vg-arch /mnt
$ mount -o defaults,noatime,ssd,discard,compress<span style="color:#5bc4bf">=</span>lzo,subvol<span style="color:#5bc4bf">=</span>__active/home /dev/mapper/vg-arch /mnt/home
$ mount -o defaults,noatime,ssd,discard,compress<span style="color:#5bc4bf">=</span>lzo,subvol<span style="color:#5bc4bf">=</span>__active/var /dev/mapper/vg-arch /mnt/var
$ mount /dev/sda1 /mnt/boot/efi
$ swapon /dev/mapper/vg-swap
$ arch-chroot /mnt</code></pre></div>
<p>Cette séquence vous permettra de remonter les volumes, et de rentrer dans le système
installé si celui-ci ne boot pas &hellip;</p>

<p>Si cela démarre, vous devriez voir un shell console attendant votre utilisateur.
Ce guide d&rsquo;installation se termine sur cette étape, cela ne rend pas fonctionnelle
sur le plan utilisateur votre installation, mais cela correspond à une version <code>serveur</code>.</p>
</div>

    
    

    
        <h4 class="page-header">Related</h4>
        
          <div class="item">

    
    
    

    
      

    <h4><a itemprop="url" href="/post/2018/01/17/test-description/">
      <span itemprop="name">Test1</span>
    </a></h4>

    January 17, 2018
    <h5>test description</h5>
     <a href="../../../../../tags/python"><kbd class="item-tag">python</kbd></a>  <a href="../../../../../tags/mopidy"><kbd class="item-tag">mopidy</kbd></a>  <a href="../../../../../tags/raspberry"><kbd class="item-tag">raspberry</kbd></a>  <a href="../../../../../tags/linux"><kbd class="item-tag">linux</kbd></a>  <a href="../../../../../tags/spotify"><kbd class="item-tag">spotify</kbd></a> 

</div>

        
    

    

</main>

        <footer>

            <p class="copyright text-muted">Geo Joy &copy; All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a> hosted on <a href="https://github.com/Geo-Joy/geo-joy.github.io">Github</a></p>

        </footer>
        
       <script async="" src="http://geojoy.me/js/main.js"></script>

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KQ3JDPK');</script>


    </body>

</html>

